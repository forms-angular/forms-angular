/*! forms-angular 2014-10-06 */
"use strict";var formsAngular=angular.module("formsAngular",["ngSanitize","ui.bootstrap","infinite-scroll","monospaced.elastic"]);formsAngular.controller("BaseCtrl",["$scope","$location","$filter","$modal","$window","$data","SchemasService","routingService","formGenerator","recordHandler",function(a,b,c,d,e,f,g,h,i,j){var k=f,l={master:{},fngInvalidRequired:"fng-invalid-required",allowLocationChange:!0};angular.extend(a,h.parsePathFunc()(b.$$path)),a.modelNameDisplay=k.modelNameDisplay||c("titleCase")(a.modelName),i.decorateScope(a,i,j,k),j.decorateScope(a,d,j,l),j.fillForm(a,i,j,l,j.handleError(a))}]).controller("SaveChangesModalCtrl",["$scope","$modalInstance",function(a,b){a.yes=function(){b.close(!0)},a.no=function(){b.close(!1)},a.cancel=function(){b.dismiss("cancel")}}]),formsAngular.controller("ModelCtrl",["$scope","$http","$location","routingService",function(a,b,c,d){a.models=[],b.get("/api/models").success(function(b){a.models=b}).error(function(){c.path("/404")}),a.newUrl=function(a){return d.buildUrl(a+"/new")},a.listUrl=function(a){return d.buildUrl(a)}}]),formsAngular.controller("NavCtrl",["$scope","$data","$location","$filter","$controller","routingService","cssFrameworkService",function(a,b,c,d,e,f,g){function h(b,c){var d,f={};b+="Ctrl",f.$scope=a.scopes[c]=a.$new();try{e(b,f),d=a.routing.newRecord?"creating":a.routing.id?"editing":"listing",angular.isObject(f.$scope.contextMenu)&&angular.forEach(f.$scope.contextMenu,function(b){b[d]&&a.items.push(b)})}catch(g){/is not a function, got undefined/.test(g.message)||console.log("Unable to instantiate "+b+" - "+g.message)}}a.items=[],a.globalShortcuts=function(a){191===a.keyCode&&a.ctrlKey&&(document.querySelector("#searchinput").focus(),a.preventDefault())},a.css=function(a,b){var c;return c="function"==typeof g[a]?g[a](b):"error text-error"},a.$on("$locationChangeSuccess",function(){if(a.routing=f.parsePathFunc()(c.$$path),a.items=[],a.routing.analyse)a.contextMenu="Report",a.items=[{broadcast:"exportToPDF",text:"PDF"},{broadcast:"exportToCSV",text:"CSV"}];else if(a.routing.modelName){angular.forEach(a.scopes,function(a){a.$destroy()}),a.scopes=[],b.record={},b.disableFunctions={},b.dataEventFunctions={},delete b.dropDownDisplay,delete b.modelNameDisplay;var e=d("titleCase")(a.routing.modelName,!0);h(e,0),a.routing.formName&&h(e+d("titleCase")(a.routing.formName,!0),1),a.contextMenu=b.dropDownDisplay||b.modelNameDisplay||d("titleCase")(a.routing.modelName,!1)}}),a.doClick=function(b){if(a.items[b].broadcast)a.$broadcast(a.items[b].broadcast);else{var c=a.items[b].args||[],d=a.items[b].fn;switch(c.length){case 0:d();break;case 1:d(c[0]);break;case 2:d(c[0],c[1]);break;case 3:d(c[0],c[1],c[2]);break;case 4:d(c[0],c[1],c[2],c[3])}}},a.isHidden=function(b){return a.items[b].isHidden?a.items[b].isHidden():!1},a.buildUrl=function(a){return f.buildUrl(a)}}]),formsAngular.directive("formButtons",["cssFrameworkService",function(a){return{restrict:"A",templateUrl:"template/form-button-"+a.framework()+".html"}}]),formsAngular.directive("formInput",["$compile","$rootScope","utils","$filter","routingService","cssFrameworkService","formGenerator",function(a,b,c,d,e,f,g){return{restrict:"EA",link:function(h,i,j){function k(a,b,d){var e="getAddAll"+a+"Options";return c[e](h,d,b)||[]}var l=[1,2,4,6,8,10,12],m=["mini","small","medium","large","xlarge","xxlarge","block-level"],n=2,o=[],p=!1,q=function(a){return!a||"undefined"===a||-1===["vertical","inline"].indexOf(a)},r=function(a,b){function c(a){var c=a;if("string"==typeof a)if("$"===a.slice(0,1)){c=(b||"record")+".";var d=a.slice(1).split(".");if(d.length>1){var e=d.pop();c+=d.join(".")+"[$index]."+e}else c+=a.slice(1)}else c="'"+a+"'";return c}var d=["eq","ne","gt","gte","lt","lte"],e=["===","!==",">",">=","<","<="],f=d.indexOf(a.comp);if(-1===f)throw new Error("Invalid comparison in showWhen");return c(a.lhs)+e[f]+c(a.rhs)},s=function(a,b,c){var d="<input "+a+'type="'+c.type+'"';return"inline"!==b.formstyle||"bs2"!==f.framework()||c.size||(d+='class="input-small"'),d+=" />"},t=function(a,b,c,d,g){var h;if(!b)if(b=(g.model||"record")+".",g.subschema&&-1!==a.name.indexOf(".")){var i=a.name,j=i.lastIndexOf("."),o=i.slice(j+1);if(g.index){var p=b.length;b+=i.slice(0,j)+"["+g.index+"]."+o,d="f_"+b.slice(p).replace(/(\.|\[|\]\.)/g,"-")}else b+=i.slice(0,j),g.subkey?(b+="[$_arrayOffset_"+i.slice(0,j).replace(/\./g,"_")+"_"+g.subkeyno+"]."+o,d=i+"_subkey"):(b+="[$index]."+o,d=null,h=i.replace(/\./g,"-"))}else b+=a.name;var r,t=c||a.required?" required":"",u=a.readonly?" readonly":"",v=a.placeHolder,w="",x="",y="",z="";"bs3"===f.framework()?(w=-1===["horizontal","vertical","inline"].indexOf(g.formstyle)?" input-sm":"",x="col-sm-"+l[a.size?m.indexOf(a.size):n],z=" form-control"):y=a.size?" input-"+a.size:"","inline"===g.formstyle&&(v=v||a.label);var A='ng-model="'+b+'"'+(d?' id="'+d+'" name="'+d+'" ':' name="'+h+'" ');switch(A+=v?'placeholder="'+v+'" ':"",a.popup&&(A+='title="'+a.popup+'" '),A+=k("Field",null,g),a.type){case"select":A+=a.readonly?"disabled ":"",a.select2?(A+='class="fng-select2'+z+w+y+'"',a.select2.fngAjax?"bs2"===f.framework()?(r='<div class="input-append">',r+='<input ui-select2="'+a.select2.fngAjax+'" '+A+">",r+='<button class="btn" type="button" data-select2-open="'+d+'" ng-click="openSelect2($event)"><i class="icon-search"></i></button>',r+="</div>"):(r='<div class="input-group">',r+='<input ui-select2="'+a.select2.fngAjax+'" '+A+">",r+='<span class="input-group-addon'+w+'" data-select2-open="'+d+'" ',r+='    ng-click="openSelect2($event)"><i class="glyphicon glyphicon-search"></i></span>',r+="</div>"):a.select2&&(r='<input ui-select2="'+a.select2.s2query+'" '+(a.readonly?"disabled ":"")+A+">")):(r="<select "+A+'class="'+z.trim()+w+y+'">',c||(r+="<option></option>"),angular.isArray(a.options)?angular.forEach(a.options,function(a){r+=_.isObject(a)?'<option value="'+(a.val||a.id)+'">'+(a.label||a.text)+"</option>":"<option>"+a+"</option>"}):r+='<option ng-repeat="option in '+a.options+'">{{option}}</option>',r+="</select>");break;case"link":r='<a ng-href="/'+e.buildUrl("")+a.ref+(a.form?"/"+a.form:"")+"/{{ "+b+'}}/edit">'+a.linkText+"</a>";break;case"radio":r="";var B="inline"!==g.formstyle&&!a.inlineRadio;if(angular.isArray(a.options))g.subschema&&(A=A.replace('name="','name="{{$index}}-')),angular.forEach(a.options,function(a){r+="<input "+A+'type="radio"',r+=' value="'+a+'">'+a,B&&(r+="<br />")});else{var C=B?"div":"span";g.subschema&&(A=A.replace("$index","$parent.$index").replace('name="','name="{{$parent.$index}}-')),r+="<"+C+' ng-repeat="option in '+a.options+'"><input '+A+' type="radio" value="{{option}}"> {{option}} </'+C+"> "}break;case"checkbox":r="bs3"===f.framework()?'<div class="checkbox"><input '+A+'type="checkbox"></div>':s(A,g,a);break;default:var D=z.trim()+w+y+(a.class?" "+a.class:"");0!==D.length&&(A+='class="'+D+'"'),a.add&&(A+=" "+a.add+" "),A+='ng-model="'+b+'"'+(d?' id="'+d+'" name="'+d+'"':"")+t+u+" ","textarea"===a.type?(a.rows&&(A+="auto"===a.rows?'msd-elastic="\n" class="ng-animate" ':'rows = "'+a.rows+'" '),"ckEditor"===a.editor&&(A+='ckeditor = "" ',"bs3"===f.framework()&&(x="col-xs-12")),r="<textarea "+A+" />"):r=s(A,g,a)}return"bs3"===f.framework()&&q(g.formstyle)&&"checkbox"!==a.type&&(r='<div class="'+x+'">'+r+"</div>"),a.helpInline&&"checkbox"!==a.type&&(r+='<span class="help-inline">'+a.helpInline+"</span>"),a.help&&(r+='<span class="help-block '+x+'">'+a.help+"</span>"),r},u=function(a){var b;switch(a){case"horizontal":b="form-horizontal";break;case"vertical":b="";break;case"inline":b="form-inline";break;case"horizontalCompact":b="form-horizontal compact";break;default:b="form-horizontal compact"}return b},v=function(a){var b={before:"",after:""};if("function"==typeof a.containerType)b=a.containerType(a);else switch(a.containerType){case"tab":b.before='<tab heading="'+a.title+'">',b.after="</tab>";break;case"tabset":b.before="<tabset>",b.after="</tabset>";break;case"well":b.before='<div class="well">',a.title&&(b.before+="<h4>"+a.title+"</h4>"),b.after="</div>";break;case"well-large":b.before='<div class="well well-lg well-large">',b.after="</div>";break;case"well-small":b.before='<div class="well well-sm well-small">',b.after="</div>";break;case"fieldset":b.before="<fieldset>",a.title&&(b.before+="<legend>"+a.title+"</legend>"),b.after="</fieldset>";break;case void 0:break;case null:break;case"":break;default:if(b.before='<div class="'+a.containerType+'">',a.title){var c=a.titleTagOrClass||"h4";b.before+=c.match(/h[1-6]/)?"<"+c+">"+a.title+"</"+c+">":'<p class="'+c+'">'+a.title+"</p>"}b.after="</div>"}return b},w=function(a,b,c){var d="";if("bs3"===f.framework()||"inline"!==c.formstyle&&""!==a.label||b){d="<label";var e="control-label";q(c.formstyle)?(d+=' for="'+a.id+'"',"bs3"===f.framework()&&(e+=" col-sm-2")):"inline"===c.formstyle&&(d+=' for="'+a.id+'"',e+=" sr-only"),d+=k("Label",null,c)+' class="'+e+'">'+a.label+(b||"")+"</label>"}return d},x=function(a,b){a.type=a.type||"text",a.id=a.id||"f_"+a.name.replace(/\./g,"_"),a.label=void 0!==a.label?null===a.label?"":a.label:d("titleCase")(a.name.split(".").slice(-1)[0]);var c="",e="",g="";"bs3"===f.framework()?(g="form-group","vertical"===b.formstyle&&"block-level"!==a.size&&(c+='<div class="row">',g+=" col-sm-"+l[a.size?m.indexOf(a.size):n],e+="</div>"),c+="<div"+k("Group",g,b),e+="</div>"):q(b.formstyle)?(c+="<div"+k("Group","control-group",b),e="</div>"):(c+="<span ",e="</span>");var i=!1;if(b.index)try{parseInt(b.index),i=!0}catch(p){}if(a.showWhen&&(c+="string"==typeof a.showWhen?'ng-show="'+a.showWhen+'"':'ng-show="'+r(a.showWhen,b.model)+'"'),c+=i?' id="cg_'+a.id.replace("_","-"+j.index+"-")+'">':' id="cg_'+a.id.replace(/\./g,"-")+'">',a.schema){var s=a.name.replace(/\./g,"_"),x="$_schema_"+s;if(h[x]=a.schema,a.schema)if(a.subkey){a.subkey.path=a.name,h[x+"_subkey"]=a.subkey;for(var z=angular.isArray(a.subkey)?a.subkey:[a.subkey],A=0;A<z.length;A++){var B=v(z[A]);c+=B.before,c+=y(a.schema,null,{subschema:!0,formStyle:b.formstyle,subkey:x+"_subkey",subkeyno:A}),c+=B.after}o.push(a)}else c+='<div class="schema-head">'+a.label+'</div><div ng-form class="'+("bs2"===f.framework()?"row-fluid ":"")+u(a.formStyle)+'" name="form_'+s+'{{$index}}" class="sub-doc well" id="'+a.id+'List_{{$index}}"  ng-repeat="subDoc in '+(b.model||"record")+"."+a.name+' track by $index">   <div class="'+("bs2"===f.framework()?"row-fluid":"row")+' sub-doc">      <div class="pull-left">'+y(a.schema,!1,{subschema:!0,formstyle:a.formStyle,model:b.model})+"      </div>",(!a.noRemove||a.customSubDoc)&&(c+='   <div class="pull-left sub-doc-btns">',a.customSubDoc&&(c+=a.customSubDoc),a.noRemove||(c+="bs2"===f.framework()?'      <button name="remove_'+a.id+'_btn" class="remove-btn btn btn-mini form-btn" ng-click="remove(\''+a.name+'\',$index,$event)">          <i class="icon-minus">':'      <button name="remove_'+a.id+'_btn" class="remove-btn btn btn-default btn-xs form-btn" ng-click="remove(\''+a.name+'\',$index,$event)">          <i class="glyphicon glyphicon-minus">',c+="          </i> Remove      </button>"),c+="  </div> "),c+="   </div></div>",(!a.noAdd||a.customFooter)&&(c+='<div class = "schema-foot">',a.customFooter&&(c+=a.customFooter),a.noAdd||(c+="bs2"===f.framework()?'    <button id="add_'+a.id+'_btn" class="add-btn btn btn-mini form-btn" ng-click="add(\''+a.name+'\',$event)">        <i class="icon-plus"></i> Add':'    <button id="add_'+a.id+'_btn" class="add-btn btn btn-default btn-xs form-btn" ng-click="add(\''+a.name+'\',$event)">        <i class="glyphicon glyphicon-plus"></i> Add',c+="    </button>"),c+="</div>")}else{var C=[];if(q(b.formstyle)&&C.push("bs2"===f.framework()?"controls":"col-sm-10"),a.array){if(C.push("fng-array"),"inline"===b.formstyle)throw"Cannot use arrays in an inline form";c+="bs2"===f.framework()?w(a,' <i id="add_'+a.id+'" ng-click="add(\''+a.name+'\',$event)" class="icon-plus-sign"></i>',b)+'<div class="'+C.join(" ")+'" id="'+a.id+'List" ng-repeat="arrayItem in '+(b.model||"record")+"."+a.name+'">'+t(a,"arrayItem.x",!0,a.id+"_{{$index}}",b)+"<i ng-click=\"remove('"+a.name+'\',$index,$event)" id="remove_'+a.id+'_{{$index}}" class="icon-minus-sign"></i></div>':w(a,' <i id="add_'+a.id+'" ng-click="add(\''+a.name+'\',$event)" class="glyphicon glyphicon-plus-sign"></i>',b)+'<div ng-class="skipCols($index)" class="'+C.join(" ")+'" id="'+a.id+'List" ng-repeat="arrayItem in '+(b.model||"record")+"."+a.name+'">'+t(a,"arrayItem.x",!0,a.id+"_{{$index}}",b)+"<i ng-click=\"remove('"+a.name+'\',$index,$event)" id="remove_'+a.id+'_{{$index}}" class="glyphicon glyphicon-minus-sign"></i></div>'}else c+=w(a,null,b),C.length>0&&(c+='<div class="'+C.join(" ")+'">'),c+=t(a,null,b.required,a.id,b),C.length>0&&(c+="</div>")}return c+=e},y=function(a,b,c){var d="";if(a)for(var e=0;e<a.length;e++){var f=a[e];0===e&&b&&!c.schema.match(/$_schema_/)&&(f.add=f.add?" "+f.add+" ":"",-1!==f.add.indexOf("ui-date")||c.noautofocus||f.containerType||(f.add=f.add+"autofocus "));var g=!0;if(f.directive){for(var j=f.directive,k="<"+j+' model="'+(c.model||"record")+'"',l=i[0],m=0;m<l.attributes.length;m++){var n=l.attributes[m];switch(n.nodeName){case"class":var o=n.nodeValue.replace("ng-scope","");o.length>0&&(k+=' class="'+o+'"');break;case"schema":var q=("bespoke_"+f.name).replace(/\./g,"_");h[q]=angular.copy(f),delete h[q].directive,k+=' schema="'+q+'"';break;default:k+=" "+n.nodeName+'="'+n.nodeValue+'"'}}f.add&&(k+=" "+f.add),k+="></"+j+">",d+=k,g=!1}else if(f.containerType){var r=v(f);switch(f.containerType){case"tab":p||(p="forced",d+="<tabset>"),d+=r.before,d+=y(f.content,null,c),d+=r.after;break;case"tabset":p=!0,d+=r.before,d+=y(f.content,null,c),d+=r.after;break;default:d+=r.before,d+=y(f.content,null,c),d+=r.after}g=!1}else if(c.subkey){var s=angular.isArray(h[c.subkey])?h[c.subkey][0].keyList:h[c.subkey].keyList;_.find(s,function(a,b){return h[c.subkey].path+"."+b===f.name})&&(g=!1)}g&&(d+=x(f,c))}else console.log("Empty array passed to processInstructions"),d="";return d},z=h.$watch(j.schema,function(c){if(c&&(c=angular.isArray(c)?c:[c],c.length>0)){z();var d="",e=h[j.model||"record"];if(e=e||{},!j.subschema&&!j.model||j.forceform){h.topLevelFormName=j.name||"myForm";var f="";for(var k in j)j.hasOwnProperty(k)&&"$"!==k[0]&&-1===["name","formstyle","schema","subschema","model"].indexOf(k)&&(f+=" "+j.$attr[k]+'="'+j[k]+'"');d='<form name="'+h.topLevelFormName+'" class="'+u(j.formstyle)+' novalidate"'+f+">"}else d="";if(e===h.topLevelFormName)throw new Error("Model and Name must be distinct - they are both "+e);if(d+=y(c,!0,j),"forced"===p&&(d+="</tabset>"),d+=j.subschema?"":"</form>",i.replaceWith(a(d)(h)),o.length>0)var l=h.$watch("phase",function(a){if("ready"===a){l();for(var b=0;b<o.length;b++)for(var c,d,f=o[b],g=angular.isArray(f.subkey)?f.subkey:[f.subkey],i=0;i<g.length;i++){for(var j=g[i].keyList,k=f.name.split("."),m=e;k.length>1;)m=m[k.shift()]||{};for(m=m[k[0]]=m[k[0]]||[],c=0;c<m.length;c++){d=!0;for(var n in j)if(j.hasOwnProperty(n)&&m[c][n]!==j[n]){d=!1;break}if(d)break}d||(c=e[f.name].push(j)-1),h["$_arrayOffset_"+f.name.replace(/\./g,"_")+"_"+i]=c}}});b.$broadcast("formInputDone"),g.updateDataDependentDisplay&&e&&Object.keys(e).length>0&&g.updateDataDependentDisplay(e,null,!0,h)}},!0)}}}]),formsAngular.controller("SearchCtrl",["$scope","$http","$location","routingService",function(a,b,c,d){var e="";a.handleKey=function(b){if(27===b.keyCode&&a.searchTarget.length>0)a.searchTarget="";else if(a.results.length>0)switch(b.keyCode){case 38:a.focus>0&&a.setFocus(a.focus-1),"function"==typeof b.preventDefault&&b.preventDefault();break;case 40:a.results.length>a.focus+1&&a.setFocus(a.focus+1),"function"==typeof b.preventDefault&&b.preventDefault();break;case 13:null!=a.focus&&a.selectResult(a.focus)}},a.setFocus=function(b){null!==a.focus&&delete a.results[a.focus].focussed,a.results[b].focussed=!0,a.focus=b},a.selectResult=function(b){var e=a.results[b];c.path(d.prefix()+"/"+e.resource+"/"+e.id+"/edit")},a.resultClass=function(b){var c="search-result";return a.results&&a.results[b].focussed&&(c+=" focus"),c};var f=function(){a.moreCount=0,a.errorClass="",a.results=[],a.focus=null};a.$watch("searchTarget",function(c){c&&c.length>0?(e=c,b.get("/api/search?q="+c).success(function(b){e===c&&(a.searchTarget.length>0?(a.results=b.results,a.moreCount=b.moreCount,b.results.length>0&&(a.errorClass="",a.setFocus(0)),a.errorClass=0===a.results.length?"error":""):f())}).error(function(a,b){console.log("Error in searchbox.js : "+a+" (status="+b+")")})):f()},!0),a.$on("$routeChangeStart",function(){a.searchTarget=""})}]).directive("globalSearch",["cssFrameworkService",function(a){return{restrict:"AE",templateUrl:"template/search-"+a.framework()+".html",controller:"SearchCtrl"}}]),formsAngular.filter("titleCase",[function(){return function(a,b){var c=a.replace(/(_|\.)/g," ").replace(/[A-Z]/g," $&").trim().replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()});return c=b?c.replace(/\s/g,""):c.replace(/\s{2,}/g," ")}}]),formsAngular.provider("cssFrameworkService",[function(){var a={framework:"bs2"};return{setOptions:function(b){angular.extend(a,b)},$get:function(){return{framework:function(){return a.framework},span:function(b){var c;switch(a.framework){case"bs2":c="span"+b;break;case"bs3":c="col-xs-"+b}return c},offset:function(b){var c;switch(a.framework){case"bs2":c="offset"+b;break;case"bs3":c="col-lg-offset-"+b}return c},rowFluid:function(){var b;switch(a.framework){case"bs2":b="row-fluid";break;case"bs3":b="row"}return b}}}}}]),formsAngular.factory("$data",[function(){var a={record:{},disableFunctions:{},dataEventFunctions:{}};return a}]),formsAngular.provider("routingService",["$injector","$locationProvider",function(a,b){function c(a){angular.forEach(a,function(a){e.when(g.prefix+a.route,a.options||{templateUrl:a.templateUrl})})}function d(a){angular.forEach(a,function(a){f.state(a.state,a.options||{url:a.route,templateUrl:a.templateUrl})})}var e,f,g={hashPrefix:"",html5Mode:!1,routing:"ngroute",prefix:""},h=[{route:"/analyse/:model/:reportSchemaName",state:"analyse::model::report",templateUrl:"partials/base-analysis.html"},{route:"/analyse/:model",state:"analyse::model",templateUrl:"partials/base-analysis.html"},{route:"/:model/:id/edit",state:"model::edit",templateUrl:"partials/base-edit.html"},{route:"/:model/new",state:"model::new",templateUrl:"partials/base-edit.html"},{route:"/:model",state:"model::list",templateUrl:"partials/base-list.html"},{route:"/:model/:form/:id/edit",state:"model::form::edit",templateUrl:"partials/base-edit.html"},{route:"/:model/:form/new",state:"model::form::new",templateUrl:"partials/base-edit.html"},{route:"/:model/:form",state:"model::form::list",templateUrl:"partials/base-list.html"}],i=null,j={};return{start:function(i){switch(angular.extend(g,i),g.prefix[0]&&"/"!==g.prefix[0]&&(g.prefix="/"+g.prefix),b.html5Mode(g.html5Mode),""!==g.hashPrefix&&b.hashPrefix(g.hashPrefix),g.routing){case"ngroute":e=a.get("$routeProvider"),g.fixedRoutes&&c(g.fixedRoutes),c(h);break;case"uirouter":f=a.get("$stateProvider"),g.fixedRoutes&&d(g.fixedRoutes),setTimeout(function(){d(h)})}},$get:function(){return{router:function(){return g.routing},prefix:function(){return g.prefix},parsePathFunc:function(){return function(a){if(a!==i){i=a,j={newRecord:!1},g.prefix.length>0&&0===a.indexOf(g.prefix)&&(a=a.slice(g.prefix.length));var b=a.split("/"),c=b.length;if("analyse"===b[1])j.analyse=!0,j.modelName=b[2];else{j.modelName=b[1];var d=b[c-1];"new"===d?(j.newRecord=!0,c--):"edit"===d&&(c-=2,j.id=b[c]),c>2&&(j.formName=b[2])}}return j}},buildUrl:function(a){var b=g.html5Mode?"":"#";return b+=g.hashPrefix,b+=g.prefix,b[0]&&(b+="/"),b+="/"===a[0]?a.slice(1):a},redirectTo:function(){return function(a,b,c,d){c.search()&&c.url(c.path());var e=b.formName?"/"+b.formName:"",f=g.prefix+"/"+b.modelName;switch(a){case"list":c.path(f+e);break;case"edit":c.path(f+e+"/"+d+"/edit");break;case"new":c.path(f+e+"/new")}}}}}}}]),formsAngular.factory("formGenerator",function(a,b,c,d,e){function f(a,b,c,d){var e="#"+(c?"cg_":"")+b,f=angular.element(document.querySelector(e));a?f.removeClass(d.fngInvalidRequired):f.addClass(d.fngInvalidRequired)}var g={};g.generateEditUrl=function(a,b){return d.buildUrl(b.modelName+"/"+(b.formName?b.formName+"/":"")+a._id+"/edit")},g.generateNewUrl=function(a){return d.buildUrl(a.modelName+"/"+(a.formName?a.formName+"/":"")+"new")},g.handleSchema=function(a,b,c,d,e,f,k,m,n){function o(a,b){var c=angular.copy(a),d=_.find(k.tabs,function(a){return a.title===c});if(!d){if(0===k.tabs.length&&k.formSchema.length>0){k.tabs.push({title:"Main",content:[]}),d=k.tabs[0];for(var e=0;e<k.formSchema.length;e++)d.content.push(k.formSchema[e])}d=k.tabs[k.tabs.push({title:c,containerType:"tab",content:[]})-1]}d.content.push(b)}for(var p in b)if("_id"!==p&&b.hasOwnProperty(p)){var q=b[p],r=q.options||{},s=r.form||{};if(!s.hidden)if(q.schema){if(f&&c){var t=[];g.handleSchema("Nested "+p,q.schema,t,null,p+".",!0,k,m,n);var u=h(p,s,e);u.schema=t,s.tab&&o(s.tab,u),void 0!==s.order?c.splice(s.order,0,u):c.push(u)}}else{if(c){var v=h(p,s,e);if(l(v.showIf,v.name,k)&&"options"!==p){var w=g.handleFieldType(v,q,r,k,m,n);w.tab&&o(w.tab,w),void 0!==s.order?c.splice(s.order,0,w):c.push(w)}}d&&i(d,r.list,p)}}d&&0===d.length&&j(a,d,c,b)},g.handleFieldType=function(d,h,i,j,k,l){var m;if(h.caster&&(d.array=!0,h=h.caster,angular.extend(i,h.options)),"String"===h.instance)i.enum?(d.type=d.type||"select",i.required&&(j.$watch("record."+d.name,function(a){f(a,d.id,d.select2,k)},!0),setTimeout(function(){f(j.record[d.name],d.id,d.select2,k)},0)),d.select2?(d.select2===!0&&(d.select2={}),d.select2.s2query="select2"+d.name.replace(/\./g,"_"),j[d.select2.s2query]={allowClear:!i.required,initSelection:function(a,c){function e(){function g(b,c,d){if(c)if(0===b.length)d(c);else{if(angular.isArray(c)){var e=a.context.id,f=e.indexOf("."+b[0]);e=e.slice(0,f),f=e.lastIndexOf("."),e=e.slice(f+1),e=/.+\[(.+)\]/.exec(e),c=c[j[e[1]]]}c=c[b.shift()],g(b,c,d)}}var h=j.record;if(h){var i=d.name.split(".");g(i,h,function(b){if(setTimeout(f(b,d.id,d.select2)),b)if(d.array){var e=parseInt(a.context.id.match("_[0-9].*$")[0].slice(1));b[e].x&&c(b[e].x)}else c(b)})}else b(e)}b(e)},query:function(a){for(var b={results:[]},c=a.term.toUpperCase(),d=0;d<i.enum.length;d++)-1!==i.enum[d].toUpperCase().indexOf(c)&&b.results.push({id:d,text:i.enum[d]});a.callback(b)}},_.extend(j[d.select2.s2query],d.select2),d.select2===!0&&(d.select2={}),j.select2List.push(d.name)):(d.options=e.suffixCleanId(d,"Options"),j[d.options]=i.enum)):(d.type||(d.type=-1!==d.name.toLowerCase().indexOf("password")?"password":"text"),i.match&&(d.add='pattern="'+i.match+'" '+(d.add||"")));else if("ObjectID"===h.instance)d.ref=i.ref,d.link&&d.link.linkOnly?(d.type="link",d.linkText=d.link.text,d.form=d.link.form,delete d.link):(d.type="select",d.select2||i.form&&i.form.select2?(d.select2||(d.select2=i.form.select2),d.select2===!0&&(d.select2={}),j.select2List.push(d.name),d.select2.fngAjax?(m="ajax"+d.name.replace(/\./g,""),j[m]={allowClear:!i.required,minimumInputLength:2,initSelection:function(b,f){var g=b.val();g&&""!==g&&c.getListAttributes(i.ref,g).success(function(c){c.success===!1&&a.path("/404");var h={id:g,text:c.list};e.setData(k.master,d.name,b,h);var i=b.inheritedData("$ngModelController"),j=i.$pristine;j&&(i.$pristine=!1),f(h),j&&(i.$pristine=!0)}).error(l)},ajax:{url:"/api/search/"+i.ref,data:function(a,b){return{q:a,pageLimit:10,page:b}},results:function(a){return{results:a.results,more:a.moreCount>0}}}},_.extend(j[m],d.select2),d.select2.fngAjax=m):(d.select2===!0&&(d.select2={}),d.select2.s2query="select2"+d.name.replace(/\./g,"_"),j["select2"+d.select2.s2query]={allowClear:!i.required,initSelection:function(a,b){var c=a.val();if(""!==c&&j[d.ids].length>0){var f=e.convertIdToListValue(c,j[d.ids],j[d.options],d.name),g={id:c,text:f};b(g)}},query:function(a){for(var b={results:[]},c=a.term.toUpperCase(),e=0;e<j[d.options].length;e++)-1!==j[d.options][e].toUpperCase().indexOf(c)&&b.results.push({id:j[d.ids][e],text:j[d.options][e]});a.callback(b)}},_.extend(j[d.select2.s2query],d.select2),j.select2List.push(d.name),d.options=e.suffixCleanId(d,"Options"),d.ids=e.suffixCleanId(d,"_ids"),e.setUpSelectOptions(i.ref,d,j,k,g.handleSchema,l))):(d.options=e.suffixCleanId(d,"Options"),d.ids=e.suffixCleanId(d,"_ids"),e.setUpSelectOptions(i.ref,d,j,k,g.handleSchema,l)));else if("Date"===h.instance)d.type||(d.readonly?d.type="text":(d.type="text",d.add="ui-date ui-date-format "));else if("boolean"===h.instance)d.type="checkbox";else{if("Number"!==h.instance)throw new Error("Field "+d.name+" is of unsupported type "+h.instance);d.type="number",i.min&&(d.add='min="'+i.min+'" '+(d.add||"")),i.max&&(d.add='max="'+i.max+'" '+(d.add||"")),d.step&&(d.add='step="'+d.step+'" '+(d.add||""))}return i.required&&(d.required=!0),i.readonly&&(d.readonly=!0),d};var h=function(a,b,c){return b.name=c+a,b},i=function(a,b,c){var d=b||{hidden:!0};d.hidden||("object"==typeof d?(d.name=c,a.push(d)):a.push({name:c}))},j=function(a,b,c,d){if(c){for(var e=0,f=c.length;f>e;e++)if("text"===c[e].type){b.push({name:c[e].name});break}0===b.length&&0!==c.length&&b.push({name:c[0].name})}if(0===b.length){for(var g in d)if("_id"!==g&&d.hasOwnProperty(g)){b.push({name:g});break}if(0===b.length)throw new Error("Unable to generate a title for "+a)}},k=function(a,b,c){function d(a){var d=a;if("string"==typeof a&&"$"===a.slice(0,1)){var f=a.split(".");switch(f.length){case 1:d=e.getListData(b,a.slice(1),c);break;case 2:d=e.getListData(b,f[1],c);break;default:throw new Error("Unsupported showIf format")}}return d}var f,g=d(a.lhs),h=d(a.rhs);switch(a.comp){case"eq":f=g===h;break;case"ne":f=g!==h;break;default:throw new Error("Unsupported comparator "+a.comp)}return f},l=function(a,b,c){function d(a){if("string"==typeof a&&"$"===a.slice(0,1)){var d=a.slice(1),f=c.dataDependencies[d]||[];f.push(b),c.dataDependencies[d]=f,e+=1}}var e=0,f=!0;return a&&(d(a.lhs),d(a.rhs),0!==e||k(a,void 0,c.select2List)||(f=!1)),f};return g.updateDataDependentDisplay=function(a,b,c,d){var e,f,g,h,i,j;for(var l in d.dataDependencies)if(d.dataDependencies.hasOwnProperty(l)){var m=l.split(".");if(1===m.length){if(c||!b||a[l]!==b[l])for(e=d.dataDependencies[l],f=0;f<e.length;f+=1){var n=e[f];for(g=0;g<d.formSchema.length;g+=1)d.formSchema[g].name===n&&(i=angular.element(document.querySelector("#cg_"+d.formSchema[g].id)),k(d.formSchema[g].showIf,a,d.select2List)?i.removeClass("ng-hide"):i.addClass("ng-hide"))}}else{if(2!==m.length)throw new Error("You can only go down one level of subdocument with showIf");if(void 0===j&&(j=!0),a[m[0]])for(h=0;h<a[m[0]].length;h++)if(c||!b||!b[m[0]]||!b[m[0]][h]||a[m[0]][h][m[1]]!==b[m[0]][h][m[1]])for(e=d.dataDependencies[l],f=0;f<e.length;f+=1){var o=e[f].split(".");if(2!==o.length)throw new Error("Conditional display must control dependent fields at same level ");for(g=0;g<d.formSchema.length;g+=1)if(d.formSchema[g].name===o[0])for(var p=d.formSchema[g].schema,q=0;q<p.length;q++)p[q].name===e[f]&&(i=angular.element(document.querySelector("#f_"+o[0]+"List_"+h+" #cg_f_"+e[f].replace(".","_"))),0===i.length?i=angular.element(document.querySelector("#f_elements-"+h+"-"+o[1])):j=!1,i.length>0&&(k(d.formSchema[g].schema[q].showIf,a[m[0]][h],d.select2List)?i.show():i.hide()))}}}return j},g.add=function(a,b,c){var d,e=a.split(".");d=c.record;for(var f=0,g=e.length;g>f;f++)d[e[f]]||(d[e[f]]=f===g-1?[]:{}),d=d[e[f]];d.push({}),c.setFormDirty(b)},g.remove=function(a,b,c,d){for(var e=a.split("."),f=d.record,g=0,h=e.length;h>g;g++)f=f[e[g]];f.splice(b,1),d.setFormDirty(c)},g.decorateScope=function(a,b,c,d){d.baseScope=a,a.record=d.record,a.phase="init",a.disableFunctions=d.disableFunctions,a.dataEventFunctions=d.dataEventFunctions,a.topLevelFormName=void 0,a.formSchema=[],a.tabs=[],a.listSchema=[],a.recordList=[],a.dataDependencies={},a.select2List=[],a.pageSize=60,a.pagesLoaded=0,a.generateEditUrl=function(c){return b.generateEditUrl(c,a)},a.generateNewUrl=function(){return b.generateNewUrl(a)},a.scrollTheList=function(){return c.scrollTheList(a,c.handleError(a))},a.getListData=function(b,d){return c.getListData(b,d,a.select2List)},a.setPristine=function(){a.dismissError(),a[a.topLevelFormName]&&a[a.topLevelFormName].$setPristine()},a.skipCols=function(a){return a>0?"col-md-offset-2":""},a.setFormDirty=function(a){if(a){var b=angular.element(a.target).inheritedData("$formController");b.$setDirty()}else console.log("setFormDirty called without an event (fine in a unit test)")},a.add=function(c,d){return b.add(c,d,a)},a.remove=function(c,d,e){return b.remove(c,d,e,a)},a.openSelect2=function(a){$("#"+$(a.currentTarget).data("select2-open")).select2("open")},a.toJSON=function(a){return JSON.stringify(a,null,2)},a.baseSchema=function(){return a.tabs.length?a.tabs:a.formSchema}},g}),formsAngular.factory("recordHandler",function(a,b,c,d,e){function f(a){var b=a.split("."),c=[b[0]];return b.length>1&&c.push(b.slice(1).join(".")),c}function g(a,b,c){var d=f(a);if(d.length>1)h(d[1],b[d[0]],c);else if(b[d[0]]){var e=b[d[0]];if(angular.isArray(e))for(var g=e.length-1;g>=0;g--){var i=typeof e[g];("undefined"===i||"object"===i&&0===Object.keys(e[g]).length)&&e.splice(g,1)}b[d[0]]=c(e)}}function h(a,b,c){if(void 0!==b)if(angular.isArray(b))for(var d=0;d<b.length;d++)g(a,b[d],c);else g(a,b,c)}function i(a,b,c,d){if(a.array){for(var e=[],f=0;f<b.length;f++)e.push({x:k.convertIdToListValue(b[f],d,c,a.name)});return e}return a.select2?{id:b,text:k.convertIdToListValue(b,d,c,a.name)}:k.convertIdToListValue(b,d,c,a.name)}function j(a,b,c,d){if(a.array){for(var e=[],f=0;f<b.length;f++)e.push(q(b[f],c,d,a.name));return e}return q(b,c,d,a.name)}var k={};k.processServerData=function(a,b,c){c.master=p(b.formSchema,a,0,b),b.phase="ready",b.cancel()},k.readRecord=function(b,c,e){d.readRecord(b.modelName,b.id).success(function(d){d.success===!1&&a.path("/404"),c.allowLocationChange=!1,b.phase="reading","function"==typeof b.dataEventFunctions.onAfterRead&&b.dataEventFunctions.onAfterRead(d),k.processServerData(d,b,c)}).error(e)},k.scrollTheList=function(b,c){d.getPagedAndFilteredList(b.modelName,{aggregate:a.$$search.a,find:a.$$search.f,limit:b.pageSize,skip:b.pagesLoaded*b.pageSize,order:a.$$search.o}).success(function(a){angular.isArray(a)?(b.pagesLoaded++,b.recordList=b.recordList.concat(a)):b.showError(a,"Invalid query")}).error(c)},k.deleteRecord=function(b,e,f,g){d.deleteRecord(b,e).success(function(){"function"==typeof f.dataEventFunctions.onAfterDelete&&f.dataEventFunctions.onAfterDelete(g.master),c.redirectTo()("list",f,a)})},k.updateDocument=function(a,c,e,f,g){e.phase="updating",d.updateRecord(e.modelName,e.id,a).success(function(a){a.success!==!1?("function"==typeof e.dataEventFunctions.onAfterUpdate&&e.dataEventFunctions.onAfterUpdate(a,g.master),c.redirect?(c.allowChange&&(g.allowLocationChange=!0),b.location=c.redirect):(k.processServerData(a,e,g),e.setPristine())):e.showError(a)}).error(f)},k.createNew=function(e,f,g,h){d.createRecord(g.modelName,e).success(function(d){d.success!==!1?("function"==typeof g.dataEventFunctions.onAfterCreate&&g.dataEventFunctions.onAfterCreate(d),f.redirect?b.location=f.redirect:c.redirectTo()("edit",g,a,d._id)):g.showError(d)}).error(h)},k.getListData=function(a,b,c){for(var d=b.split("."),e=0;e<d.length;e++)void 0!==a&&(a=a[d[e]]);return a&&-1!==c.indexOf(d[e-1])&&(a=a.text||a),void 0===a&&(a=""),a};var l=function(a,b,c){for(var d=b.split("."),e=d.length-1,f=a,g=0;e>g&&(f=angular.isArray(f)?_.map(f,function(a){return a[d[g]]}):f[d[g]],angular.isArray(f)&&c&&c.scope&&"function"==typeof c.scope&&(f=f[c.scope().$index]),f);g++);return{lastObject:f,key:f?d[e]:void 0}};k.suffixCleanId=function(a,b){return(a.id||"f_"+a.name).replace(/\./g,"_")+b};var m=function(a,b,c){var d,e=l(a,b,c);return e.lastObject&&e.key&&(d=angular.isArray(e.lastObject)?_.map(e.lastObject,function(a){return a[e.key]
}):e.lastObject[e.key]),d};k.setData=function(a,b,c,d){var e=l(a,b,c);if(e.lastObject&&e.key)if(angular.isArray(e.lastObject))for(var f=0;f<e.lastObject.length;f++)e.lastObject[f][e.key]=d[f];else e.lastObject[e.key]=d};var n=function(a,b,c){if(!b.topLevelFormName||b[b.topLevelFormName].$pristine){g(a.name,c.master,function(c){return i(a,c,b[k.suffixCleanId(a,"Options")],b[k.suffixCleanId(a,"_ids")])});var d=m(c.master,a.name);d&&k.setData(b.record,a.name,void 0,d)}};k.setUpSelectOptions=function(a,b,c,f,g,h){var i=c[b.options]=[],j=c[b.ids]=[];e.getSchema(a).success(function(e){var k=[];g("Lookup "+a,e,null,k,"",!1,c,f,h),d.getAll(a).success(function(a){if(a){for(var d=0;d<a.length;d++){for(var e="",g=0;g<k.length;g++)e+=a[d][k[g].name]+" ";e=e.trim();var h=_.sortedIndex(i,e);i[h]===e&&(e=e+"    ("+a[d]._id+")",h=_.sortedIndex(i,e)),i.splice(h,0,e),j.splice(h,0,a[d]._id)}n(b,c,f)}})})};var o=function(a){var b=!1;return"text"===a.type?b=!0:"select"!==a.type||a.ids||(b=!0),b},p=function(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e].name.slice(c);if(a[e].schema){var g=m(b,f);if(g)for(var h=0;h<g.length;h++)g[h]=p(a[e].schema,g[h],c+1+f.length,d)}else{var j=k.getListData(b,f,d.select2List);if(a[e].array&&o(a[e])&&j)for(var l=0;l<j.length;l++)j[l]={x:j[l]};var n=d[k.suffixCleanId(a[e],"_ids")];if(n&&n.length>0&&b[f])b[f]=i(a[e],b[f],d[k.suffixCleanId(a[e],"Options")],n);else if(a[e].select2&&!a[e].select2.fngAjax&&b[f])if(a[e].array)for(var q=0;q<b[f].length;q++)d[a[e].select2.s2query].query({term:b[f][q].x.text||b[f][q].text||b[f][q].x||b[f][q],callback:function(a){a.results.length>0&&(b[f][q].x?b[f][q].x=a.results[0]:b[f][q]=a.results[0])}});else d[a[e].select2.s2query].query({term:b[f],callback:function(a){a.results.length>0&&(b[f]=a.results[0])}})}}return b};k.convertToMongoModel=function(a,b,c,d){function e(a,b){var c;return b.select2.fngAjax?a&&a.id&&(c=a.id):a&&(c=a.text||a.x.text),c}for(var f=0;f<a.length;f++){var h=a[f].name.slice(c),i=k.getListData(b,h,d.select2List);if(a[f].schema){if(i)for(var l=0;l<i.length;l++)i[l]=k.convertToMongoModel(a[f].schema,i[l],c+1+h.length,d)}else{if(a[f].array&&o(a[f])&&i)for(var n=0;n<i.length;n++)i[n]=i[n].x;var p=d[k.suffixCleanId(a[f],"_ids")];if(p&&p.length>0)g(h,b,function(b){return j(a[f],b,d[k.suffixCleanId(a[f],"Options")],p)});else if(a[f].select2){var q,r=m(b,h,null);if(a[f].array){if(q=[],r)for(var s=0;s<r.length;s++)q[s]=e(r[s],a[f])}else q=e(r,a[f]);k.setData(b,h,null,q)}}}return b},k.convertIdToListValue=function(a,b,c,d){var e=b.indexOf(a);if(-1===e)throw new Error("convertIdToListValue: Invalid data - id "+a+" not found in "+b+" processing "+d);return c[e]};var q=function(a,b,c,d){var e=_.isObject(a)?a.x||a.text:a;if(e&&e.match(/^[0-9a-f]{24}$/))return e;var f=b.indexOf(e);if(-1===f)throw new Error("convertListValueToId: Invalid data - value "+e+" not found in "+b+" processing "+d);return c[f]};return k.handleError=function(a){return function(b,c){if(-1!==[200,400].indexOf(c)){var d="";for(var e in b.errors)if(b.errors.hasOwnProperty(e)){switch(d+="<li><b>"+$filter("titleCase")(e)+": </b> ",b.errors[e].type){case"enum":d+="You need to select from the list of values";break;default:d+=b.errors[e].message}d+="</li>"}d=d.length>0?b.message+"<br /><ul>"+d+"</ul>":b.message||"Error!  Sorry - No further details available.",a.showError(d)}else a.showError(c+" "+JSON.stringify(b))}},k.decorateScope=function(d,e,f,g){d.cancel=function(){angular.copy(g.master,d.record),d.setPristine()};var h=k.handleError(d);d.$on("showErrorMessage",function(a,b){d.showError(b.body,b.title)}),d.showError=function(a,b){d.alertTitle=b?b:"Error!",d.errorMessage=a},d.dismissError=function(){delete d.errorMessage},d.save=function(a){a=a||{};var b=f.convertToMongoModel(d.formSchema,angular.copy(d.record),0,d);d.id?"function"==typeof d.dataEventFunctions.onBeforeUpdate?d.dataEventFunctions.onBeforeUpdate(b,g.master,function(c){c?d.showError(c):f.updateDocument(b,a,d,h,g)}):f.updateDocument(b,a,d,h,g):"function"==typeof d.dataEventFunctions.onBeforeCreate?d.dataEventFunctions.onBeforeCreate(b,function(c){c?d.showError(c):f.createNew(b,a,d,h)}):f.createNew(b,a,d,h)},d.newClick=function(){c.redirectTo()("new",d,a)},d.$on("$locationChangeStart",function(a,c){if(!g.allowLocationChange&&!d.isCancelDisabled()){a.preventDefault();var f=e.open({template:'<div class="modal-header">   <h3>Record modified</h3></div><div class="modal-body">   <p>Would you like to save your changes?</p></div><div class="modal-footer">    <button class="btn btn-primary dlg-yes" ng-click="yes()">Yes</button>    <button class="btn btn-warning dlg-no" ng-click="no()">No</button>    <button class="btn dlg-cancel" ng-click="cancel()">Cancel</button></div>',controller:"SaveChangesModalCtrl",backdrop:"static"});f.result.then(function(a){a?d.save({redirect:c,allowChange:!0}):(g.allowLocationChange=!0,b.location=c)})}}),d.deleteClick=function(){if(d.record._id){var a=e.open({template:'<div class="modal-header">   <h3>Delete Item</h3></div><div class="modal-body">   <p>Are you sure you want to delete this record?</p></div><div class="modal-footer">    <button class="btn btn-primary dlg-no" ng-click="cancel()">No</button>    <button class="btn btn-warning dlg-yes" ng-click="yes()">Yes</button></div>',controller:"SaveChangesModalCtrl",backdrop:"static"});a.result.then(function(a){a&&("function"==typeof d.dataEventFunctions.onBeforeDelete?d.dataEventFunctions.onBeforeDelete(g.master,function(a){a?d.showError(a):f.deleteRecord(d.modelName,d.id,d,g)}):f.deleteRecord(d.modelName,d.id,d,g))})}},d.isCancelDisabled=function(){return"function"==typeof d.disableFunctions.isCancelDisabled?d.disableFunctions.isCancelDisabled(d.record,g.master,d[d.topLevelFormName]):d[d.topLevelFormName]&&d[d.topLevelFormName].$pristine},d.isSaveDisabled=function(){return"function"==typeof d.disableFunctions.isSaveDisabled?d.disableFunctions.isSaveDisabled(d.record,g.master,d[d.topLevelFormName]):d[d.topLevelFormName]&&(d[d.topLevelFormName].$invalid||d[d.topLevelFormName].$pristine)},d.isDeleteDisabled=function(){return"function"==typeof d.disableFunctions.isDeleteDisabled?d.disableFunctions.isDeleteDisabled(d.record,g.master,d[d.topLevelFormName]):!d.id},d.isNewDisabled=function(){return"function"==typeof d.disableFunctions.isNewDisabled?d.disableFunctions.isNewDisabled(d.record,g.master,d[d.topLevelFormName]):!1},d.disabledText=function(a){var b="";return d.isSaveDisabled&&(b="This button is only enabled when the form is complete and valid.  Make sure all required inputs are filled in. "+a),b}},k.fillForm=function(a,b,c,d,f){e.getSchema(a.modelName,a.formName).success(function(e){var g=!a.id&&!a.newRecord;if(b.handleSchema("Main "+a.modelName,e,g?null:a.formSchema,a.listSchema,"",!0,a,d,f),g)d.allowLocationChange=!0;else{var h=!0;a.$watch("record",function(c,d){c!==d&&(h=b.updateDataDependentDisplay(c,d,h,a))},!0),a.id?"function"==typeof a.dataEventFunctions.onBeforeRead?a.dataEventFunctions.onBeforeRead(a.id,function(b){b?a.showError(b):c.readRecord(a,d,f)}):c.readRecord(a,d,f):(d.master={},a.phase="ready",a.cancel())}}).error(f)},k}),formsAngular.factory("SchemasService",["$http",function(a){return{getSchema:function(b,c){return a.get("/api/schema/"+b+(c?"/"+c:""),{cache:!0})}}}]),formsAngular.factory("SubmissionsService",["$http",function(a){var b=function(a){var b="?l="+a.limit,c=function(a,c){c&&""!==c&&(b+="&"+a+"="+c)};return c("f",a.find),c("a",a.aggregate),c("o",a.order),c("s",a.skip),b};return{getListAttributes:function(b,c){return a.get("/api/"+b+"/"+c+"/list")},readRecord:function(b,c){return a.get("/api/"+b+"/"+c)},getAll:function(b){return a.get("/api/"+b,{cache:!0})},getPagedAndFilteredList:function(c,d){return a.get("/api/"+c+b(d))},deleteRecord:function(b,c){return a.delete("/api/"+b+"/"+c)},updateRecord:function(b,c,d){return a.post("/api/"+b+"/"+c,d)},createRecord:function(b,c){return a.post("/api/"+b,c)}}}]),formsAngular.service("utils",function(){function a(a,b,c,d){function e(a){for(var b in a)b===c&&i.push(a[b]),"$parent"===b&&e(a[b])}var f,g,h,i=[],j=[];if(c="addAll"+c,"string"==typeof d)for(f=d.split(" "),g=0;g<f.length;g++)j.push(f[g]);if(e(a),void 0!==b[c])if("object"==typeof b[c]);else if("string"==typeof b[c])for(f=b[c].split(" "),g=0;g<f.length;g++)0===f[g].indexOf("class=")?j.push(f[g].substring(6,f[g].length)):i.push(f[g]);return d=j.length>0?' class="'+j.join(" ")+'" ':" ",h=i.length>0?i.join(" ")+" ":"",d+h}this.getAddAllGroupOptions=function(b,c,d){return a(b,c,"Group",d)},this.getAddAllFieldOptions=function(b,c,d){return a(b,c,"Field",d)},this.getAddAllLabelOptions=function(b,c,d){return a(b,c,"Label",d)}}),angular.module("formsAngular").run(["$templateCache",function(a){a.put("template/form-button-bs2.html",'<div class="btn-group pull-right"><button id=saveButton class="btn btn-mini btn-primary form-btn" ng-click=save() ng-disabled=isSaveDisabled()><i class=icon-ok></i> Save</button> <button id=cancelButton class="btn btn-mini btn-warning form-btn" ng-click=cancel() ng-disabled=isCancelDisabled()><i class=icon-remove></i> Cancel</button></div><div class="btn-group pull-right"><button id=newButton class="btn btn-mini btn-success form-btn" ng-click=newClick() ng-disabled=isNewDisabled()><i class=icon-plus></i> New</button> <button id=deleteButton class="btn btn-mini btn-danger form-btn" ng-click=deleteClick() ng-disabled=isDeleteDisabled()><i class=icon-minus></i> Delete</button></div>'),a.put("template/form-button-bs3.html",'<div class="btn-group pull-right"><button id=saveButton class="btn btn-primary form-btn btn-xs" ng-click=save() ng-disabled=isSaveDisabled()><i class="glyphicon glyphicon-ok"></i> Save</button> <button id=cancelButton class="btn btn-warning form-btn btn-xs" ng-click=cancel() ng-disabled=isCancelDisabled()><i class="glyphicon glyphicon-remove"></i> Cancel</button></div><div class="btn-group pull-right"><button id=newButton class="btn btn-success form-btn btn-xs" ng-click=newClick() ng-disabled=isNewDisabled()><i class="glyphicon glyphicon-plus"></i> New</button> <button id=deleteButton class="btn btn-danger form-btn btn-xs" ng-click=deleteClick() ng-disabled=isDeleteDisabled()><i class="glyphicon glyphicon-minus"></i> Delete</button></div>'),a.put("template/search-bs2.html",'<form class="navbar-search pull-right"><div id=search-cg class=control-group ng-class=errorClass><input id=searchinput ng-model=searchTarget class=search-query placeholder="Ctrl+Slash to Search" ng-keyup=handleKey($event)></div></form><div class=results-container ng-show="results.length >= 1"><div class=search-results><div ng-repeat="result in results"><span ng-class=resultClass($index) ng-click=selectResult($index)>{{result.resourceText}} {{result.text}}</span></div><div ng-show="moreCount > 0">(plus more - continue typing to narrow down search...)</div></div></div>'),a.put("template/search-bs3.html",'<form class="pull-right navbar-form"><div id=search-cg class=form-group ng-class=errorClass><input id=searchinput ng-model=searchTarget class="search-query form-control" placeholder="Ctrl+Slash to Search" ng-keyup=handleKey($event)></div></form><div class=results-container ng-show="results.length >= 1"><div class=search-results><div ng-repeat="result in results"><span ng-class=resultClass($index) ng-click=selectResult($index)>{{result.resourceText}} {{result.text}}</span></div><div ng-show="moreCount > 0">(plus more - continue typing to narrow down search...)</div></div></div>')}]);