!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.fng=t()}(this,function(){var e;!function(e){e.formsAngular=angular.module("formsAngular",["ngSanitize","ui.bootstrap","infinite-scroll","monospaced.elastic"]),void e.formsAngular}(e||(e={}));var e;!function(e){e.formsAngular.controller("BaseCtrl",["$scope","$rootScope","$location","$filter","$modal","$window","$data","SchemasService","routingService","formGenerator","recordHandler",function(e,t,r,n,a,o,i,s,l,c,u){var d=i,f={master:{},fngInvalidRequired:"fng-invalid-required",allowLocationChange:!0};angular.extend(e,l.parsePathFunc()(r.$$path)),e.modelNameDisplay=d.modelNameDisplay||n("titleCase")(e.modelName),t.$broadcast("fngFormLoadStart",e),c.decorateScope(e,c,u,d),u.decorateScope(e,a,u,f),u.fillFormWithBackendSchema(e,c,u,f,u.handleError(e));for(var m=0;m<d.modelControllers.length;m++)d.modelControllers[m].onBaseCtrlReady&&d.modelControllers[m].onBaseCtrlReady(e)}]).controller("SaveChangesModalCtrl",["$scope","$modalInstance",function(e,t){e.yes=function(){t.close(!0)},e.no=function(){t.close(!1)},e.cancel=function(){t.dismiss("cancel")}}])}(e||(e={}));var e;!function(e){e.formsAngular.controller("ModelCtrl",["$scope","$http","$location","routingService",function(e,t,r,n){e.models=[],t.get("/api/models").success(function(t){e.models=t}).error(function(){r.path("/404")}),e.newUrl=function(e){return n.buildUrl(e+"/new")},e.listUrl=function(e){return n.buildUrl(e)}}])}(e||(e={}));var e;!function(e){e.formsAngular.controller("NavCtrl",["$scope","$data","$location","$filter","$controller","routingService","cssFrameworkService",function(e,t,r,n,a,o,i){function s(r,n,o){var i,s={};r+="Ctrl",s.$scope=t.modelControllers[n]=e.$new();try{a(r,s),i=e.routing.newRecord?"creating":e.routing.id?"editing":"listing",angular.isObject(s.$scope.contextMenu)&&angular.forEach(s.$scope.contextMenu,function(t){t.divider?o=!0:t[i]&&(o&&(o=!1,e.items.push({divider:!0})),e.items.push(t))})}catch(l){/is not a function, got undefined/.test(l.message)||console.log("Unable to instantiate "+r+" - "+l.message)}}e.items=[],e.isCollapsed=!0,e.globalShortcuts=function(e){191===e.keyCode&&e.ctrlKey&&(document.querySelector("#searchinput").focus(),e.preventDefault())},e.css=function(e,t){var r;return r="function"==typeof i[e]?i[e](t):"error text-error"},e.$on("$locationChangeSuccess",function(){if(e.routing=o.parsePathFunc()(r.$$path),e.items=[],e.routing.analyse)e.contextMenu="Report",e.items=[{broadcast:"exportToPDF",text:"PDF"},{broadcast:"exportToCSV",text:"CSV"}];else if(e.routing.modelName){angular.forEach(t.modelControllers,function(e){e.$destroy()}),t.modelControllers=[],t.record={},t.disableFunctions={},t.dataEventFunctions={},delete t.dropDownDisplay,delete t.modelNameDisplay;var a=n("titleCase")(e.routing.modelName,!0),i=!1;s(a,0,i),e.routing.formName&&s(a+n("titleCase")(e.routing.formName,!0),1,i),e.contextMenu=t.dropDownDisplay||t.modelNameDisplay||n("titleCase")(e.routing.modelName,!1)}}),e.doClick=function(t,r){var n=angular.element(r.target),a=e.items[t];if(a.divider||n.parent().hasClass("disabled"))r.preventDefault();else if(a.broadcast)e.$broadcast(a.broadcast);else{var o=a.args||[],i=a.fn;switch(o.length){case 0:i();break;case 1:i(o[0]);break;case 2:i(o[0],o[1]);break;case 3:i(o[0],o[1],o[2]);break;case 4:i(o[0],o[1],o[2],o[3])}}},e.isHidden=function(t){return e.items[t].isHidden?e.items[t].isHidden():!1},e.isDisabled=function(t){return e.items[t].isDisabled?e.items[t].isDisabled():!1},e.buildUrl=function(e){return o.buildUrl(e)},e.dropdownClass=function(t){var r=e.items[t],n="";return r.divider?n="divider":e.isDisabled(t)&&(n="disabled"),n}}])}(e||(e={}));var e;!function(e){e.formsAngular.directive("modelControllerDropdown",function(){return{restrict:"AE",replace:!0,template:'<li ng-show="items.length > 0" class="dropdown mcdd" dropdown> <a class="dropdown-toggle" dropdown-toggle>  {{contextMenu}} <b class="caret"></b> </a> <ul class="dropdown-menu">  <li ng-repeat="choice in items" ng-hide="isHidden($index)" ng-class="dropdownClass($index)">   <a ng-show="choice.text" class="dropdown-option" ng-href="{{choice.url}}" ng-click="doClick($index, $event)">    {{choice.text}}   </a>  </li> </ul></li>'}})}(e||(e={}));var e;!function(e){e.formsAngular.directive("errorDisplay",function(){return{restrict:"E",template:'<div id="display-error" ng-show="errorMessage" ng-class="css(\'rowFluid\')">  <div class="alert alert-error col-lg-offset-3 offset3 col-lg-6 col-xs-12 span6 alert-warning alert-dismissable">    <button type="button" class="close" ng-click="dismissError()">Ã—</button>    <h4>{{alertTitle}}</h4>    <div ng-bind-html="errorMessage"></div>  </div></div>'}})}(e||(e={}));var e;!function(e){e.formsAngular.directive("fngLink",function(e,t){return{restrict:"E",scope:{dataSrc:"&model"},link:function(r,n,a){var o=a.ref,i=a.form;r.readonly=a.readonly,i=i?i+"/":"",a.text&&a.text.length>0&&(r.text=a.text),r.$watch("dataSrc()",function(n){n&&(r.link=e.buildUrl(o+"/"+i+n+"/edit"),r.text||t.getListAttributes(o,n).success(function(e){e.success===!1?(console.log(e.err),r.text=e.err):r.text=e.list}).error(function(e,t){r.text="Error "+e+": "+t}))},!0)},template:function(e,t){return t.readonly?'<span class="fng-link">{{text}}</span>':'<a href="{{ link }}" class="fng-link">{{text}}</a>'}}})}(e||(e={}));var e;!function(e){e.formsAngular.directive("formButtons",["cssFrameworkService",function(e){return{restrict:"A",templateUrl:"template/form-button-"+e.framework()+".html"}}])}(e||(e={}));var e;!function(e){var t;!function(e){e[e.Y=0]="Y",e[e.N=1]="N",e[e.Forced=2]="Forced"}(t||(t={})),e.formsAngular.directive("formInput",["$compile","$rootScope","$filter","$data","routingService","cssFrameworkService","formGenerator","formMarkupHelper",function(e,t,r,n,a,o,i,s){return{restrict:"EA",link:function(a,l,c){var u=[],d=1,f=function(e,t,r,n,i){var l;if(!t){var c=(i.model||"record")+".";if(t=c,i.subschema&&-1!==e.name.indexOf(".")){var u=e.name,d=i.subschemaroot,f=u.slice(d.length+1);i.index?(t+=d+"["+i.index+"]."+f,n="f_"+t.slice(c.length).replace(/(\.|\[|\]\.)/g,"-")):(t+=d,i.subkey?(n=t.slice(c.length).replace(/\./g,"-")+"-subkey"+i.subkeyno+"-"+f,t+="[$_arrayOffset_"+d.replace(/\./g,"_")+"_"+i.subkeyno+"]."+f):(t+="[$index]."+f,n=null,l=u.replace(/\./g,"-")))}else t+=e.name}var m,p=s.allInputsVars(a,e,i,t,n,l),h=p.common,g=r||e.required?" required":"";switch(e.type){case"select":e.select2?(h+='class="fng-select2'+p.formControl+p.compactClass+p.sizeClassBS2+'"',h+=e.readonly?" readonly":"",h+=e.required?' ng-required="true"':"",e.select2.fngAjax?"bs2"===o.framework()?(m='<div class="input-append">',m+='<input ui-select2="'+e.select2.fngAjax+'" '+h+">",m+='<button class="btn" type="button" data-select2-open="'+n+'" ng-click="openSelect2($event)"><i class="icon-search"></i></button>',m+="</div>"):(m='<div class="input-group">',m+='<input ui-select2="'+e.select2.fngAjax+'" '+h+">",m+='<span class="input-group-addon'+p.compactClass+'" data-select2-open="'+n+'" ',m+='    ng-click="openSelect2($event)"><i class="glyphicon glyphicon-search"></i></span>',m+="</div>"):e.select2&&(m='<input ui-select2="'+e.select2.s2query+'" '+h+">")):(h+=e.readonly?"disabled ":"",m="<select "+h+'class="'+p.formControl.trim()+p.compactClass+p.sizeClassBS2+'" '+g+">",r||(m+="<option></option>"),angular.isArray(e.options)?angular.forEach(e.options,function(e){m+=_.isObject(e)?'<option value="'+(e.val||e.id)+'">'+(e.label||e.text)+"</option>":"<option>"+e+"</option>"}):m+='<option ng-repeat="option in '+e.options+'">{{option}}</option>',m+="</select>");break;case"link":m='<fng-link model="'+t+'" ref="'+e.ref+'"',e.form&&(m+=' form="'+e.form+'"'),e.linkText&&(m+=' text="'+e.linkText+'"'),e.readonly&&(m+=' readonly="true"'),m+="></fng-link>";break;case"radio":m="",h+=g+(e.readonly?" disabled ":" ");var v="vertical"===i.formstyle||"inline"!==i.formstyle&&!e.inlineRadio;if(angular.isArray(e.options))i.subschema&&(h=h.replace('name="','name="{{$index}}-')),angular.forEach(e.options,function(e){m+="<input "+h+'type="radio"',m+=' value="'+e+'">'+e,v&&(m+="<br />")});else{var b=v?"div":"span";i.subschema&&(h=h.replace("$index","$parent.$index").replace('name="','name="{{$parent.$index}}-')),m+="<"+b+' ng-repeat="option in '+e.options+'"><input '+h+' type="radio" value="{{option}}"> {{option}} </'+b+"> "}break;case"checkbox":h+=g+(e.readonly?" disabled ":" "),m="bs3"===o.framework()?'<div class="checkbox"><input '+h+'type="checkbox"></div>':s.generateSimpleInput(h,e,i);break;default:h+=s.addTextInputMarkup(p,e,g),"textarea"===e.type?(e.rows&&(h+="auto"===e.rows?'msd-elastic="\n" class="ng-animate" ':'rows = "'+e.rows+'" '),"ckEditor"===e.editor&&(h+='ckeditor = "" ',"bs3"===o.framework()&&(p.sizeClassBS3="col-xs-12")),m="<textarea "+h+" />"):m=s.generateSimpleInput(h,e,i)}return s.inputChrome(m,e,i,p)},m=function(e){var t;switch(e){case"horizontal":t="form-horizontal";break;case"vertical":t="";break;case"inline":t="form-inline";break;case"horizontalCompact":t="form-horizontal compact";break;default:t="form-horizontal compact"}return t},p=function(e){var t={before:"",after:""};if("function"==typeof e.containerType)t=e.containerType(e);else switch(e.containerType){case"tab":for(var r=-1,n=0;n<a.tabs.length;n++)if(a.tabs[n].title===e.title){r=n;break}r>=0?(t.before="<tab select=\"updateQueryForTab('"+e.title+'\')" heading="'+e.title+'" active="tabs['+r+'].active">',t.after="</tab>"):(t.before="<p>Error!  Tab "+e.title+" not found in tab list</p>",t.after="");break;case"tabset":t.before="<tabset>",t.after="</tabset>";break;case"well":t.before='<div class="well">',e.title&&(t.before+="<h4>"+e.title+"</h4>"),t.after="</div>";break;case"well-large":t.before='<div class="well well-lg well-large">',t.after="</div>";break;case"well-small":t.before='<div class="well well-sm well-small">',t.after="</div>";break;case"fieldset":t.before="<fieldset>",e.title&&(t.before+="<legend>"+e.title+"</legend>"),t.after="</fieldset>";break;case void 0:break;case null:break;case"":break;default:if(t.before='<div class="'+e.containerType+'">',e.title){var o=e.titleTagOrClass||"h4";t.before+=o.match(/h[1-6]/)?"<"+o+">"+e.title+"</"+o+">":'<p class="'+o+'">'+e.title+"</p>"}t.after="</div>"}return t},h=function(e,t){var r=s.fieldChrome(a,e,t),n=r.template;if(e.schema){var i=e.name.replace(/\./g,"_"),l="$_schema_"+i;if(a[l]=e.schema,e.schema)if(e.subkey){e.subkey.path=e.name,a[l+"_subkey"]=e.subkey;for(var c=angular.isArray(e.subkey)?e.subkey:[e.subkey],d=0;d<c.length;d++){var h=p(c[d]);n+=h.before,n+=v(e.schema,null,{subschema:!0,formStyle:t.formstyle,subkey:l+"_subkey",subkeyno:d,subschemaroot:e.name}),n+=h.after}u.push(e)}else t.subschema?console.log("Attempts at supporting deep nesting have been removed - will hopefully be re-introduced at a later date"):(n+='<div class="schema-head">'+e.label,e.unshift&&(n+='<button id="unshift_'+e.id+'_btn" class="add-btn btn btn-default btn-xs btn-mini form-btn" ng-click="unshift(\''+e.name+'\',$event)"><i class="'+s.glyphClass()+'-plus"></i> Add</button>'),n+='</div><div ng-form class="'+("bs2"===o.framework()?"row-fluid ":"")+m(e.formStyle)+'" name="form_'+i+'{{$index}}" class="sub-doc well" id="'+e.id+'List_{{$index}}"  ng-repeat="subDoc in '+(t.model||"record")+"."+e.name+' track by $index">   <div class="'+("bs2"===o.framework()?"row-fluid":"row")+' sub-doc">',(!e.noRemove||e.customSubDoc)&&(n+='   <div class="sub-doc-btns">',e.customSubDoc&&(n+=e.customSubDoc),e.noRemove||(n+='<button name="remove_'+e.id+'_btn" class="remove-btn btn btn-mini btn-default btn-xs form-btn" ng-click="remove(\''+e.name+'\',$index,$event)"><i class="'+s.glyphClass()+'-minus"></i> Remove</button>'),n+="  </div> "),n+=v(e.schema,!1,{subschema:!0,formstyle:e.formStyle,model:t.model,subschemaroot:e.name}),n+="   </div></div>",(!e.noAdd||e.customFooter)&&(n+='<div class = "schema-foot">',e.customFooter&&(n+=e.customFooter),e.noAdd||(n+='<button id="add_'+e.id+'_btn" class="add-btn btn btn-default btn-xs btn-mini form-btn" ng-click="add(\''+e.name+'\',$event)"><i class="'+s.glyphClass()+'-plus"></i> Add</button>'),n+="</div>"))}else{var g=s.controlDivClasses(t);if(e.array){if(g.push("fng-array"),"inline"===t.formstyle)throw new Error("Cannot use arrays in an inline form");n+=s.label(a,e,!0,t),n+=s.handleArrayInputAndControlDiv(f(e,"arrayItem.x",!0,e.id+"_{{$index}}",t),g,e,t)}else n+=s.label(a,e,null,t),n+=s.handleInputAndControlDiv(f(e,null,t.required,e.id,t),g)}return n+=r.closeTag},g=function(e){e.type=e.type||"text",e.id=e.id||"f_"+e.name.replace(/\./g,"_"),e.label=void 0!==e.label?null===e.label?"":e.label:r("titleCase")(e.name.split(".").slice(-1)[0])},v=function(e,t,r){var n="";if(e)for(var o=0;o<e.length;o++){var i=e[o];0===o&&t&&!r.schema.match(/$_schema_/)&&(i.add=i.add?" "+i.add+" ":"",-1!==i.add.indexOf("ui-date")||r.noautofocus||i.containerType||(i.add=i.add+"autofocus "));var s=!0;if(i.directive){var u=i.directive,f="<"+u+' model="'+(r.model||"record")+'"',m=l[0];g(i);for(var b=0;b<m.attributes.length;b++){var y=m.attributes[b];switch(y.nodeName){case"class":var w=y.value.replace("ng-scope","");w.length>0&&(f+=' class="'+w+'"');break;case"schema":var k=("bespoke_"+i.name).replace(/\./g,"_");a[k]=angular.copy(i),delete a[k].directive,f+=' schema="'+k+'"';break;default:f+=" "+y.nodeName+'="'+y.value+'"'}}var x=c.$normalize(i.directive);for(var C in i)if(i.hasOwnProperty(C))switch(C){case"directive":break;case"schema":break;case"add":switch(typeof i.add){case"string":f+=" "+i.add;break;case"object":for(var $ in i.add)f+=" "+$+'="'+i.add[$].toString().replace(/"/g,"&quot;")+'"';break;default:throw new Error("Invalid add property of type "+typeof i.add+" in directive "+i.name)}break;case x:for(var S in i[C])f+=i.directive+"-"+S+'="'+i[C][S]+'"';break;default:f+=" fng-fld-"+C+'="'+i[C].toString().replace(/"/g,"&quot;")+'"'}for(C in r)r.hasOwnProperty(C)&&"$"!==C[0]&&"undefined"!=typeof r[C]&&(f+=" fng-opt-"+C+'="'+r[C].toString().replace(/"/g,"&quot;")+'"');f+="></"+u+">",n+=f,s=!1}else if(i.containerType){var A=p(i);switch(i.containerType){case"tab":1===d&&(d=2,n+="<tabset>"),n+=A.before,n+=v(i.content,null,r),n+=A.after;break;case"tabset":d=0,n+=A.before,n+=v(i.content,null,r),n+=A.after;break;default:n+=A.before,n+=v(i.content,null,r),n+=A.after}s=!1}else if(r.subkey){var F=angular.isArray(a[r.subkey])?a[r.subkey][0].keyList:a[r.subkey].keyList;_.find(F,function(e,t){return a[r.subkey].path+"."+t===i.name})&&(s=!1)}s&&(g(i),n+=h(i,r))}else console.log("Empty array passed to processInstructions"),n="";return n},b=a.$watch(c.schema,function(r){if(r&&(r=angular.isArray(r)?r:[r],r.length>0)){b();var o="",s=c.model||"record",f=a[s];if(f=f||{},!c.subschema&&!c.model||c.forceform){a.topLevelFormName=c.name||"myForm";var p="";for(var h in c)c.hasOwnProperty(h)&&"$"!==h[0]&&-1===["name","formstyle","schema","subschema","model"].indexOf(h)&&(p+=" "+c.$attr[h]+'="'+c[h]+'"');o='<form name="'+a.topLevelFormName+'" class="'+m(c.formstyle)+' novalidate"'+p+">"}else o="";if(f===a.topLevelFormName)throw new Error("Model and Name must be distinct - they are both "+f);if(o+=v(r,!0,c),2===d&&(o+="</tabset>"),o+=c.subschema?"":"</form>",l.replaceWith(e(o)(a)),u.length>0||n.modelControllers.length>0)var g=a.$watch("phase",function(e){if("ready"===e){g();for(var t=0;t<n.modelControllers.length;t++)n.modelControllers[t].onAllReady&&n.modelControllers[t].onAllReady(a);for(var r=0;r<u.length;r++){for(var o,i,s=u[r],l=angular.isArray(s.subkey)?s.subkey:[s.subkey],c=s.name.split("."),d=f;c.length>1;)d=d[c.shift()]||{};d=d[c[0]]=d[c[0]]||[];for(var m=0;m<l.length;m++){if(l[m].selectFunc){if(!a[l[m].selectFunc]||"function"!=typeof a[l[m].selectFunc])throw new Error("Subkey function "+l[m].selectFunc+" is not properly set up");o=a[l[m].selectFunc](f,s)}else{if(!l[m].keyList)throw new Error("Invalid subkey setup for "+s.name);var p=l[m].keyList;for(o=0;o<d.length;o++){i=!0;for(var h in p)if(p.hasOwnProperty(h)&&d[o][h]!==p[h]&&("undefined"==typeof d[o][h]||!d[o][h].text||d[o][h].text!==p[h])){i=!1;break}if(i)break}i||(o=f[s.name].push(p)-1)}a["$_arrayOffset_"+s.name.replace(/\./g,"_")+"_"+m]=o}}}});t.$broadcast("formInputDone"),i.updateDataDependentDisplay&&f&&Object.keys(f).length>0&&i.updateDataDependentDisplay(f,null,!0,a)}},!0)}}}])}(e||(e={}));var e;!function(e){e.formsAngular.controller("SearchCtrl",["$scope","$http","$location","routingService",function(e,t,r,n){var a,o="";a=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),!e}(),e.searchPlaceholder=a?"Ctrl + / to Search":"Search",e.handleKey=function(t){if(27===t.keyCode&&e.searchTarget.length>0)e.searchTarget="";else if(e.results.length>0)switch(t.keyCode){case 38:e.focus>0&&e.setFocus(e.focus-1),"function"==typeof t.preventDefault&&t.preventDefault();break;case 40:e.results.length>e.focus+1&&e.setFocus(e.focus+1),"function"==typeof t.preventDefault&&t.preventDefault();break;case 13:null!=e.focus&&e.selectResult(e.focus)}},e.setFocus=function(t){null!==e.focus&&delete e.results[e.focus].focussed,e.results[t].focussed=!0,e.focus=t},e.selectResult=function(t){var a=e.results[t],o=n.prefix()+"/"+a.resource+"/"+a.id+"/edit";a.resourceTab&&(o+="/"+a.resourceTab),r.url(o)},e.resultClass=function(t){var r="search-result";return e.results&&e.results[t].focussed&&(r+=" focus"),r};var i=function(){e.moreCount=0,e.errorClass="",e.results=[],e.focus=null};e.$watch("searchTarget",function(r){r&&r.length>0?(o=r,t.get("/api/search?q="+r).success(function(t){o===r&&(e.searchTarget.length>0?(e.results=t.results,e.moreCount=t.moreCount,t.results.length>0&&(e.errorClass="",e.setFocus(0)),e.errorClass=0===e.results.length?"error has-error":""):i())}).error(function(e,t){console.log("Error in searchbox.js : "+e+" (status="+t+")")})):i()},!0),e.$on("$routeChangeStart",function(){e.searchTarget=""})}]).directive("globalSearch",["cssFrameworkService",function(e){return{restrict:"AE",templateUrl:"template/search-"+e.framework()+".html",controller:"SearchCtrl"}}])}(e||(e={}));var e;!function(e){e.formsAngular.filter("titleCase",[function(){return function(e,t){var r=e.replace(/(_|\.)/g," ").replace(/[A-Z]/g," $&").trim().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()});return r=t?r.replace(/\s/g,""):r.replace(/\s{2,}/g," ")}}])}(e||(e={}));var e;!function(e){e.formsAngular.service("addAllService",function(){function e(e,t,r,n){function a(e){for(var t in e)t===r&&l.push(e[t]),"$parent"===t&&a(e[t])}var o,i,s,l=[],c=[];if(r="addAll"+r,"string"==typeof n)for(o=n.split(" "),i=0;i<o.length;i++)c.push(o[i]);if(a(e),void 0!==t[r]&&"string"==typeof t[r])for(o=t[r].split(" "),i=0;i<o.length;i++)0===o[i].indexOf("class=")?c.push(o[i].substring(6,o[i].length)):l.push(o[i]);return n=c.length>0?' class="'+c.join(" ")+'" ':" ",s=l.length>0?l.join(" ")+" ":"",n+s}this.getAddAllGroupOptions=function(t,r,n){return e(t,r,"Group",n)},this.getAddAllFieldOptions=function(t,r,n){return e(t,r,"Field",n)},this.getAddAllLabelOptions=function(t,r,n){return e(t,r,"Label",n)},this.addAll=function(e,t,r,n){var a="getAddAll"+t+"Options";return this[a](e,n,r)||[]}})}(e||(e={}));var e;!function(e){e.formsAngular.provider("cssFrameworkService",[function(){var e={framework:"bs2"};return{setOptions:function(t){angular.extend(e,t)},$get:function(){return{framework:function(){return e.framework},setFrameworkForDemoWebsite:function(t){e.framework=t},span:function(t){var r;switch(e.framework){case"bs2":r="span"+t;break;case"bs3":r="col-xs-"+t}return r},offset:function(t){var r;switch(e.framework){case"bs2":r="offset"+t;break;case"bs3":r="col-lg-offset-"+t}return r},rowFluid:function(){var t;switch(e.framework){case"bs2":t="row-fluid";break;case"bs3":t="row"}return t}}}}}])}(e||(e={}));var e;!function(e){e.formsAngular.factory("$data",[function(){var e={record:{},disableFunctions:{},dataEventFunctions:{},modelControllers:[]};return e}])}(e||(e={}));var e;!function(e){e.formsAngular.provider("routingService",["$injector","$locationProvider",function(e,t){function r(e,t,r){void 0===t&&(t=""),t=t||"",angular.forEach(e,function(e){o.when(t+e.route,angular.extend(e.options||{templateUrl:e.templateUrl},r))}),s.variantsForDemoWebsite&&angular.forEach(s.variantsForDemoWebsite,function(n){angular.forEach(e,function(e){o.when(t+n+e.route,angular.extend(e.options||{templateUrl:e.templateUrl},r))})})}function n(e,t,r){void 0===t&&(t=""),t=t||"",angular.forEach(e,function(e){i.state(e.state,angular.extend(e.options||{url:t+e.route,templateUrl:e.templateUrl},r))})}function a(e,t,r,n,a,o){var i,s=n?"/"+n:"",l=e+"/"+r,c=o?"/"+o:"";switch(t){case"list":i=l+s;break;case"edit":i=l+s+"/"+a+"/edit"+c;break;case"new":i=l+s+"/new"+c}return i}var o,i,s={hashPrefix:"",html5Mode:!1,routing:"ngroute",prefix:""},l=[{route:"/analyse/:model/:reportSchemaName",state:"analyse::model::report",templateUrl:"partials/base-analysis.html"},{route:"/analyse/:model",state:"analyse::model",templateUrl:"partials/base-analysis.html"},{route:"/:model/:id/edit",state:"model::edit",templateUrl:"partials/base-edit.html"},{route:"/:model/:id/edit/:tab",state:"model::edit::tab",templateUrl:"partials/base-edit.html"},{route:"/:model/new",state:"model::new",templateUrl:"partials/base-edit.html"},{route:"/:model",state:"model::list",templateUrl:"partials/base-list.html"},{route:"/:model/:form/:id/edit",state:"model::form::edit",templateUrl:"partials/base-edit.html"},{route:"/:model/:form/:id/edit/:tab",state:"model::form::edit::tab",templateUrl:"partials/base-edit.html"},{route:"/:model/:form/new",state:"model::form::new",templateUrl:"partials/base-edit.html"},{route:"/:model/:form",state:"model::form::list",templateUrl:"partials/base-list.html"}],c=null,u={};return{start:function(a){switch(angular.extend(s,a),s.prefix[0]&&"/"!==s.prefix[0]&&(s.prefix="/"+s.prefix),t.html5Mode(s.html5Mode),""!==s.hashPrefix&&t.hashPrefix(s.hashPrefix),s.routing){case"ngroute":o=e.get("$routeProvider"),s.fixedRoutes&&r(s.fixedRoutes),r(l,s.prefix,a.add2fngRoutes);break;case"uirouter":i=e.get("$stateProvider"),s.fixedRoutes&&n(s.fixedRoutes),setTimeout(function(){n(l,s.prefix,a.add2fngRoutes)})}},$get:function(){return{router:function(){return s.routing},prefix:function(){return s.prefix},parsePathFunc:function(){return function(e){if(e!==c){c=e,u={newRecord:!1},s.prefix.length>0&&0===e.indexOf(s.prefix)&&(e=e.slice(s.prefix.length));var t=e.split("/");s.variants&&-1!==s.variants.indexOf(t[1])&&(u.variant=t[1],t.shift());var r=t.length;if("analyse"===t[1])u.analyse=!0,u.modelName=t[2],u.reportSchemaName=r>=4?t[3]:null;else{u.modelName=t[1];var n,a=[t[r-1],t[r-2]],o=a.indexOf("new");-1===o?(n=a.indexOf("edit"),-1!==n&&(r-=2+n,u.id=t[r])):(u.newRecord=!0,r-=1+o),(1===n||1===o)&&(u.tab=a[0]),r>2&&(u.formName=t[2])}}return u}},buildUrl:function(e){var t=s.html5Mode?"":"#";return t+=s.hashPrefix,t+=s.prefix,t[0]&&(t+="/"),t+="/"===e[0]?e.slice(1):e},buildOperationUrl:function(e,t,r,n,o){return a(s.prefix,e,t,r,n,o)},redirectTo:function(){return function(e,t,r,n,o){r.search()&&r.url(r.path());var i=a(s.prefix,e,t.modelName,t.formName,n,o);r.path(i)}}}}}}])}(e||(e={}));var e;!function(e){e.formsAngular.factory("formGenerator",function(e,t,r,n,a){function o(e,t,r,n,a,s,l,f,p){function h(e,t){var r=angular.copy(e),n=_.find(l.tabs,function(e){return e.title===r});if(!n){if(0===l.tabs.length&&l.formSchema.length>0){l.tabs.push({title:"Main",content:[],active:"Main"===l.tab||!l.tab}),n=l.tabs[0];for(var a=0;a<l.formSchema.length;a++)n.content.push(l.formSchema[a])}n=l.tabs[l.tabs.push({title:r,containerType:"tab",content:[],active:r===l.tab})-1]}n.content.push(t)}for(var g in t)if("_id"!==g&&t.hasOwnProperty(g)){var v=t[g],b=v.options||{},y=b.form||{};if(!y.hidden)if(v.schema){if(s&&r){var w=[];o("Nested "+g,v.schema,w,null,g+".",!0,l,f,p);var k=c(g,y,a);k.schema=w,y.tab&&h(y.tab,k),void 0!==y.order?r.splice(y.order,0,k):r.push(k)}}else{if(r){var x=c(g,y,a);if(m(x.showIf,x.name,l)&&"options"!==g){var C=i(x,v,b,l,f,p);C.tab&&h(C.tab,C),void 0!==y.order?r.splice(y.order,0,C):r.push(C)}}n&&u(n,b.list,g)}}n&&0===n.length&&d(e,n,r,t)}function i(n,i,l,c,u,d){var f;if(i.caster&&(n.array=!0,i=i.caster,angular.extend(l,i.options),i.options&&i.options.form&&angular.extend(n,i.options.form)),"String"===i.instance)l["enum"]?(n.type=n.type||"select",n.select2?(c.conversions[n.name]=n.select2,l.required&&(c.$watch("record."+n.name,function(e){s(e,n.id,n.select2,u)},!0),setTimeout(function(){s(c.record[n.name],n.id,n.select2,u)},0)),n.select2===!0&&(n.select2={}),n.select2.s2query="select2"+n.name.replace(/\./g,"_"),c[n.select2.s2query]={allowClear:!l.required,initSelection:function(e,r){function o(){function i(t,r,n){if(r)if(0===t.length)n(r);else{if(angular.isArray(r)){var a=e.context.getAttribute("ng-model"),o=a.indexOf("."+t[0]);a=a.slice(0,o),o=a.lastIndexOf("."),a=a.slice(o+1),a=/.+\[(.+)\]/.exec(a),r=r[c[a[1]]]}r=r[t.shift()],i(t,r,n)}}var l=c.record;if(l){var d=n.name.split(".");i(d,l,function(t){if(setTimeout(s(t,n.id,n.select2,u)),t)if(n.array){var o=parseInt(e.context.id.match("_[0-9].*$")[0].slice(1));t[o].x&&a.preservePristine(e,function(){r(t[o].x)})}else a.preservePristine(e,function(){r(t)})})}else t(o)}t(o)},query:function(e){for(var t={results:[]},r=e.term.toUpperCase(),n=0;n<l["enum"].length;n++)-1!==l["enum"][n].toUpperCase().indexOf(r)&&t.results.push({id:n,text:l["enum"][n]});e.callback(t)}},_.extend(c[n.select2.s2query],n.select2),n.select2===!0&&(n.select2={}),c.select2List.push(n.name)):(n.options=a.suffixCleanId(n,"Options"),c[n.options]=l["enum"])):(n.type||(n.type=-1!==n.name.toLowerCase().indexOf("password")?"password":"text"),l.match&&(n.add='pattern="'+l.match+'" '+(n.add||"")));else if("ObjectID"===i.instance)n.ref=l.ref,n.link&&n.link.linkOnly?(n.type="link",n.linkText=n.link.text,n.form=n.link.form,delete n.link):(n.type="select",n.select2||l.form&&l.form.select2?(n.select2||(n.select2=l.form.select2),n.select2===!0&&(n.select2={}),c.select2List.push(n.name),c.conversions[n.name]=n.select2,n.select2.fngAjax?(f="ajax"+n.name.replace(/\./g,""),l.required||n.placeHolder||(n.placeHolder="Select..."),c[f]={allowClear:!l.required,minimumInputLength:2,initSelection:function(t,n){var o=t.val();o&&""!==o&&r.getListAttributes(l.ref,o).success(function(r){r.success===!1&&e.path("/404");var i={id:o,text:r.list};a.preservePristine(t,function(){n(i)})}).error(d)},ajax:{url:"/api/search/"+l.ref,data:function(e,t){var r,n={q:e,pageLimit:10,page:t};return"object"==typeof l.form.searchQuery?r=l.form.searchQuery:"function"==typeof l.form.searchQuery&&(r=l.form.searchQuery(c,l)),r&&_.extend(n,r),n},results:function(e){return{results:e.results,more:e.moreCount>0}}}},_.extend(c[f],n.select2),n.select2.fngAjax=f):(n.select2===!0&&(n.select2={}),n.select2.s2query="select2"+n.name.replace(/\./g,"_"),c["select2"+n.select2.s2query]={allowClear:!l.required,initSelection:function(e,t){var r=e.val();if(""!==r&&c[n.ids].length>0){var o=a.convertIdToListValue(r,c[n.ids],c[n.options],n.name),i={id:r,text:o};t(i)}},query:function(e){for(var t={results:[]},r=e.term.toUpperCase(),a=0;a<c[n.options].length;a++)-1!==c[n.options][a].toUpperCase().indexOf(r)&&t.results.push({id:c[n.ids][a],text:c[n.options][a]});e.callback(t)}},_.extend(c[n.select2.s2query],n.select2),n.options=a.suffixCleanId(n,"Options"),n.ids=a.suffixCleanId(n,"_ids"),a.setUpSelectOptions(l.ref,n,c,u,o,d))):n.directive&&n[$.camelCase(n.directive)]&&n[$.camelCase(n.directive)].fngAjax||(n.options=a.suffixCleanId(n,"Options"),n.ids=a.suffixCleanId(n,"_ids"),a.setUpSelectOptions(l.ref,n,c,u,o,d)));else if("Date"===i.instance)n.type||(n.readonly?n.type="text":(n.type="text",n.add="ui-date ui-date-format datepicker-popup-fix "));else if("boolean"===i.instance)n.type="checkbox";else{if("Number"!==i.instance)throw new Error("Field "+n.name+" is of unsupported type "+i.instance);n.type="number",l.min&&(n.add='min="'+l.min+'" '+(n.add||"")),l.max&&(n.add='max="'+l.max+'" '+(n.add||"")),n.step&&(n.add='step="'+n.step+'" '+(n.add||""))}return l.required&&(n.required=!0),l.readonly&&(n.readonly=!0),n}function s(e,t,r,n){var a="#"+(r?"cg_":"")+t,o=angular.element(document.querySelector(a));e?o.removeClass(n.fngInvalidRequired):o.addClass(n.fngInvalidRequired)}function l(e,t){for(var r=e.split("."),n=t.record,a=0,o=r.length;o>a;a++)n[r[a]]||(n[r[a]]=a===o-1?[]:{}),n=n[r[a]];return n}var c=function(e,t,r){return t.name=r+e,t},u=function(e,t,r){var n=t||{hidden:!0};n.hidden||("object"==typeof n?(n.name=r,e.push(n)):e.push({name:r}))},d=function(e,t,r,n){if(r){for(var a=0,o=r.length;o>a;a++)if("text"===r[a].type){t.push({name:r[a].name});break}0===t.length&&0!==r.length&&t.push({name:r[0].name})}if(0===t.length){for(var i in n)if("_id"!==i&&n.hasOwnProperty(i)){t.push({name:i});break}if(0===t.length)throw new Error("Unable to generate a title for "+e)}},f=function(e,t,r){function n(e){var n=e;if("string"==typeof e&&"$"===e.slice(0,1)){var o=e.split(".");switch(o.length){case 1:n=a.getListData(t,e.slice(1),r);break;case 2:n=a.getListData(t,o[1],r);break;default:throw new Error("Unsupported showIf format")}}return n}var o,i=n(e.lhs),s=n(e.rhs);switch(e.comp){case"eq":o=i===s;break;case"ne":o=i!==s;break;default:throw new Error("Unsupported comparator "+e.comp)}return o},m=function(e,t,r){function n(e){if("string"==typeof e&&"$"===e.slice(0,1)){var n=e.slice(1),o=r.dataDependencies[n]||[];o.push(t),r.dataDependencies[n]=o,a+=1}}var a=0,o=!0;return e&&(n(e.lhs),n(e.rhs),0!==a||f(e,void 0,r.select2List)||(o=!1)),o};return{generateEditUrl:function(e,t){return n.buildUrl(t.modelName+"/"+(t.formName?t.formName+"/":"")+e._id+"/edit")},generateNewUrl:function(e){return n.buildUrl(e.modelName+"/"+(e.formName?e.formName+"/":"")+"new")},handleFieldType:i,handleSchema:o,updateDataDependentDisplay:function(e,t,r,n){var a,o,i,s,l,c;for(var u in n.dataDependencies)if(n.dataDependencies.hasOwnProperty(u)){var d=u.split(".");if(1===d.length){if(r||!t||e[u]!==t[u])for(a=n.dataDependencies[u],
o=0;o<a.length;o+=1){var m=a[o];for(i=0;i<n.formSchema.length;i+=1)n.formSchema[i].name===m&&(l=angular.element(document.querySelector("#cg_"+n.formSchema[i].id)),f(n.formSchema[i].showIf,e,n.select2List)?l.removeClass("ng-hide"):l.addClass("ng-hide"))}}else{if(2!==d.length)throw new Error("You can only go down one level of subdocument with showIf");if(void 0===c&&(c=!0),e[d[0]])for(s=0;s<e[d[0]].length;s++)if(r||!t||!t[d[0]]||!t[d[0]][s]||e[d[0]][s][d[1]]!==t[d[0]][s][d[1]])for(a=n.dataDependencies[u],o=0;o<a.length;o+=1){var p=a[o].split(".");if(2!==p.length)throw new Error("Conditional display must control dependent fields at same level ");for(i=0;i<n.formSchema.length;i+=1)if(n.formSchema[i].name===p[0])for(var h=n.formSchema[i].schema,g=0;g<h.length;g++)h[g].name===a[o]&&(l=angular.element(document.querySelector("#f_"+p[0]+"List_"+s+" #cg_f_"+a[o].replace(".","_"))),0===l.length?l=angular.element(document.querySelector("#f_elements-"+s+"-"+p[1])):c=!1,l.length>0&&(f(n.formSchema[i].schema[g].showIf,e[d[0]][s],n.select2List)?l.show():l.hide()))}}}return c},add:function(e,t,r){var n=l(e,r);n.push({}),r.setFormDirty(t)},unshift:function(e,t,r){var n=l(e,r);n.unshift({}),r.setFormDirty(t)},remove:function(e,t,r,n){for(var a=e.split("."),o=n.record,i=0,s=a.length;s>i;i++)o=o[a[i]];o.splice(t,1),n.setFormDirty(r)},hasError:function(e,t,r,n){var a=!1;if(n){var o=n[n.topLevelFormName];if("null"!==e&&(o=o[e.replace("$index",r)]),o){var i=o[t];i&&i.$invalid&&(i.$dirty?a=!0:angular.forEach(i.$validators,function(e,t){"required"!==t&&i.$error[t]&&(a=!0)}))}}else console.log("hasError called with no scope! ",e,t,r);return a},decorateScope:function(e,t,r,n){e.record=n.record,e.phase="init",e.disableFunctions=n.disableFunctions,e.dataEventFunctions=n.dataEventFunctions,e.topLevelFormName=void 0,e.formSchema=[],e.tabs=[],e.listSchema=[],e.recordList=[],e.dataDependencies={},e.select2List=[],e.conversions={},e.pageSize=60,e.pagesLoaded=0,n.baseScope=e,e.generateEditUrl=function(r){return t.generateEditUrl(r,e)},e.generateNewUrl=function(){return t.generateNewUrl(e)},e.scrollTheList=function(){return r.scrollTheList(e,r.handleError(e))},e.getListData=function(t,n){return r.getListData(t,n,e.select2List)},e.setPristine=function(){e.dismissError(),e[e.topLevelFormName]&&e[e.topLevelFormName].$setPristine()},e.skipCols=function(e){return e>0?"col-md-offset-3":""},e.setFormDirty=function(e){if(e){var t=angular.element(e.target).inheritedData("$formController");t.$setDirty()}else console.log("setFormDirty called without an event (fine in a unit test)")},e.add=function(r,n){return t.add(r,n,e)},e.hasError=function(r,n,a){return t.hasError(r,n,a,e)},e.unshift=function(r,n){return t.unshift(r,n,e)},e.remove=function(r,n,a){return t.remove(r,n,a,e)},e.openSelect2=function(e){$("#"+$(e.currentTarget).data("select2-open")).select2("open")},e.toJSON=function(e){return"The toJSON function is deprecated - use the json filter instead\n\n"+JSON.stringify(e,null,2)},e.baseSchema=function(){return e.tabs.length?e.tabs:e.formSchema}}}})}(e||(e={}));var e;!function(e){e.formsAngular.factory("formMarkupHelper",["cssFrameworkService","inputSizeHelper","addAllService",function(e,t,r){function n(e,t){function r(e){var r=e;if("string"==typeof e)if("$"===e.slice(0,1)){r=(t||"record")+".";var n=e.slice(1).split(".");if(n.length>1){var a=n.pop();r+=n.join(".")+"[$index]."+a}else r+=e.slice(1)}else r="'"+e+"'";return r}var n=["eq","ne","gt","gte","lt","lte"],a=["===","!==",">",">=","<","<="],o=n.indexOf(e.comp);if(-1===o)throw new Error("Invalid comparison in showWhen");return r(e.lhs)+a[o]+r(e.rhs)}function a(){return"bs2"===e.framework()?"icon":"glyphicon glyphicon"}var o=function(e){return!e||"undefined"===e||-1===["vertical","inline"].indexOf(e)};return{isHorizontalStyle:o,fieldChrome:function(a,i,s){var l="",c="",u="",d="";if(i.showWhen=i.showWhen||i.showwhen,i.showWhen&&(d+="string"==typeof i.showWhen?'ng-show="'+i.showWhen+'"':'ng-show="'+n(i.showWhen,s.model)+'"'),d+=' id="cg_'+i.id.replace(/\./g,"-")+'"',"bs3"===e.framework()){l="form-group","vertical"===s.formstyle&&"block-level"!==i.size&&(c+='<div class="row">',l+=" col-sm-"+t.sizeAsNumber(i.size),u+="</div>");var f,m=null,p=i.name.split(".");s&&"undefined"!=typeof s.subkeyno?f=s.subschemaroot.replace(/\./g,"-")+"-subkey"+s.subkeyno+"-"+p[p.length-1]:s.subschema?(m="form_"+p.slice(0,-1).join("_")+"$index",f=i.name.replace(/\./g,"-")):f="f_"+i.name.replace(/\./g,"_"),c+="<div"+r.addAll(a,"Group",l,s)+" ng-class=\"{'has-error': hasError('"+m+"','"+f+"', $index)}\"",u+="</div>"}else o(s.formstyle)?(c+="<div"+r.addAll(a,"Group","control-group",s),u="</div>"):(c+="<span ",u="</span>");return c+=(d||"")+">",{template:c,closeTag:u}},label:function(t,n,i,s){var l="";if("bs3"===e.framework()||"inline"!==s.formstyle&&""!==n.label||i){l="<label";var c="control-label";o(s.formstyle)?(l+=' for="'+n.id+'"',"undefined"!=typeof n.labelDefaultClass?c+=" "+n.labelDefaultClass:"bs3"===e.framework()&&(c+=" col-sm-3")):"inline"===s.formstyle&&(l+=' for="'+n.id+'"',c+=" sr-only"),l+=r.addAll(t,"Label",null,s)+' class="'+c+'">'+n.label,i&&(l+=' <i id="add_'+n.id+'" ng-click="add(\''+n.name+'\',$event)" class="'+a()+'-plus-sign"></i>'),l+="</label>"}return l},glyphClass:a,allInputsVars:function(n,a,o,i,s,l){var c,u=a.placeHolder,d="",f="",m="",p="";return"bs3"===e.framework()?(d=-1===["horizontal","vertical","inline"].indexOf(o.formstyle)?" input-sm":"",f="col-sm-"+t.sizeAsNumber(a.size),p=" form-control"):m=a.size?" input-"+a.size:"","inline"===o.formstyle&&(u=u||a.label),c='ng-model="'+i+'"'+(s?' id="'+s+'" name="'+s+'" ':' name="'+l+'" '),c+=u?'placeholder="'+u+'" ':"",a.popup&&(c+='title="'+a.popup+'" '),c+=r.addAll(n,"Field",null,o),{common:c,sizeClassBS3:f,sizeClassBS2:m,compactClass:d,formControl:p}},inputChrome:function(t,r,n,a){return"bs3"===e.framework()&&o(n.formstyle)&&"checkbox"!==r.type&&(t='<div class="bs3-input '+a.sizeClassBS3+'">'+t+"</div>"),r.helpInline&&(t+='<span class="'+("bs2"===e.framework()?"help-inline":"help-block")+'">'+r.helpInline+"</span>"),r.help&&(t+='<span class="help-block">'+r.help+"</span>"),t},generateSimpleInput:function(t,r,n){var a="<input "+t+'type="'+r.type+'"';return"inline"!==n.formstyle||"bs2"!==e.framework()||r.size||(a+='class="input-small"'),a+=" />"},controlDivClasses:function(t){var r=[];return o(t.formstyle)&&r.push("bs2"===e.framework()?"controls":"col-sm-9"),r},handleInputAndControlDiv:function(e,t){return t.length>0&&(e='<div class="'+t.join(" ")+'">'+e+"</div>"),e},handleArrayInputAndControlDiv:function(t,r,n,o){var i="<div ";return"bs3"===e.framework()&&(i+='ng-class="skipCols($index)" '),i+='class="'+r.join(" ")+'" id="'+n.id+'List" ',i+='ng-repeat="arrayItem in '+(o.model||"record")+"."+n.name+' track by $index">',i+=t,i+="<i ng-click=\"remove('"+n.name+'\',$index,$event)" id="remove_'+n.id+'_{{$index}}" class="'+a()+'-minus-sign"></i>',i+="</div>"},addTextInputMarkup:function(e,t,r){var n="",a=e.formControl.trim()+e.compactClass+e.sizeClassBS2+(t["class"]?" "+t["class"]:"");return 0!==a.length&&(n+='class="'+a+'"'),t.add&&(n+=" "+t.add+" "),n+=r+(t.readonly?" readonly":"")+" "}}}])}(e||(e={}));var e;!function(e){e.formsAngular.factory("inputSizeHelper",[function(){var e=[1,2,4,6,8,10,12],t=["mini","small","medium","large","xlarge","xxlarge","block-level"],r=2,n={sizeMapping:e,sizeDescriptions:t,defaultSizeOffset:r,sizeAsNumber:function(n){return e[n?t.indexOf(n):r]}};return n}])}(e||(e={}));var e;!function(e){e.formsAngular.factory("pluginHelper",["formMarkupHelper",function(e){return{extractFromAttr:function(e,t){var r={},n={formStyle:e.formstyle},a={},o=t.length;for(var i in e)e.hasOwnProperty(i)&&("fngFld"===i.slice(0,6)?r[i.slice(6).toLowerCase()]=e[i].replace(/&quot;/g,'"'):"fngOpt"===i.slice(0,6)?n[i.slice(6).toLowerCase()]=e[i].replace(/&quot;/g,'"'):i.slice(0,o)===t&&(a[i.slice(o).toLowerCase()]=e[i].replace(/&quot;/g,'"')));return{info:r,options:n,directiveOptions:a}},buildInputMarkup:function(t,r,n,a,o,i,s){var l,c,u,d=e.fieldChrome(t,n,a,' id="cg_'+n.id+'"'),f=e.controlDivClasses(a),m=d.template+e.label(t,n,o,a);if(o?(l="arrayItem"+(i?".x":""),c=n.id+"_{{$index}}",u=n.name+"_{{$index}}"):(l=r+"."+n.name,c=n.id,u=n.name),a.subschema&&-1!==n.name.indexOf(".")){var p=r+".",h=n.name,g=a.subschemaroot,v=h.slice(g.length+1);l=p,a.index?(l+=g+"["+a.index+"]."+v,c="f_"+l.slice(p.length).replace(/(\.|\[|\]\.)/g,"-")):(l+=g,a.subkey?(c=l.slice(p.length).replace(/\./g,"-")+"-subkey"+a.subkeyno+"-"+v,l+="[$_arrayOffset_"+g.replace(/\./g,"_")+"_"+a.subkeyno+"]."+v):(l+="[$index]."+v,c=null,u=h.replace(/\./g,"-")))}var b=e.allInputsVars(t,n,a,l,c,u);return m+=e["handle"+(o?"Array":"")+"InputAndControlDiv"](e.inputChrome(s(b),n,a,b),f,n,a),m+=d.closeTag},findIdInSchemaAndFlagNeedX:function t(e,r){for(var n=!1,a=0;a<e.length;a++){var o=e[a];if(o.id===r){o.needsX=!0,n=!0;break}if(o.schema&&t(o.schema,r)){n=!0;break}}return n}}}])}(e||(e={}));var e;!function(e){e.formsAngular.factory("recordHandler",function(e,t,r,n,a,o,i){function s(e){var t=e.split("."),r=[t[0]];return t.length>1&&r.push(t.slice(1).join(".")),r}function l(e,t,r){var n=s(e);if(n.length>1)c(n[1],t[n[0]],r);else if(t[n[0]]){var a=t[n[0]];if(angular.isArray(a))for(var o=a.length-1;o>=0;o--){var i=typeof a[o];("undefined"===i||"object"===i&&0===Object.keys(a[o]).length)&&a.splice(o,1)}t[n[0]]=r(a)}}function c(e,t,r){if(void 0!==t)if(angular.isArray(t))for(var n=0;n<t.length;n++)l(e,t[n],r);else l(e,t,r)}function u(e,t,r,n){if(e.array){for(var a=[],o=!e.directive||w(e),i=0;i<t.length;i++){var s=t[i];s&&s.x&&(s=s.x);var l=$(s,n,r,e.name);o&&(l={x:l}),a.push(l)}return a}return e.select2?{id:t,text:$(t,n,r,e.name)}:$(t,n,r,e.name)}function d(e,t,r,n){if(e.array){for(var a=[],o=0;o<t.length;o++)a.push(x(t[o],r,n,e.name));return a}return x(t,r,n,e.name)}function f(e){return function(t,n){if(-1!==[200,400].indexOf(n)){var a="";for(var o in t.errors)if(t.errors.hasOwnProperty(o)){switch(a+="<li><b>"+r("titleCase")(o)+": </b> ",t.errors[o].type){case"enum":a+="You need to select from the list of values";break;default:a+=t.errors[o].message}a+="</li>"}a=a.length>0?t.message+"<br /><ul>"+a+"</ul>":t.message||"Error!  Sorry - No further details available.",e.showError(a)}else e.showError(n+" "+JSON.stringify(t))}}function m(e,t,r,n,a,o){var i=!t.id&&!t.newRecord;if(r.handleSchema("Main "+t.modelName,e,i?null:t.formSchema,t.listSchema,"",!0,t,a,o),i)a.allowLocationChange=!0;else{var s=!0;t.$watch("record",function(e,n){e!==n&&(s=r.updateDataDependentDisplay(e,n,s,t))},!0),t.id?"function"==typeof t.dataEventFunctions.onBeforeRead?t.dataEventFunctions.onBeforeRead(t.id,function(e){e?t.showError(e):n.readRecord(t,a,o)}):n.readRecord(t,a,o):(a.master={},t.phase="ready",t.cancel())}}var p=function(e,t){return(e.id||"f_"+e.name).replace(/\./g,"_")+t},h=function(e,t,r){for(var n=t.split("."),a=n.length-1,o=e,i=0;a>i&&(o=angular.isArray(o)?_.map(o,function(e){return e[n[i]]}):o[n[i]],angular.isArray(o)&&r&&r.scope&&"function"==typeof r.scope&&(o=o[r.scope().$index]),o);i++);return{lastObject:o,key:o?n[a]:void 0}},g=function(e,t,r,n){var a=h(e,t,r);if(a.lastObject&&a.key)if(angular.isArray(a.lastObject))for(var o=0;o<a.lastObject.length;o++)a.lastObject[o][a.key]=n[o];else a.lastObject[a.key]=n},v=function(e,t,r){var n,a=h(e,t,r);return a.lastObject&&a.key&&(n=angular.isArray(a.lastObject)?_.map(a.lastObject,function(e){return e[a.key]}):a.lastObject[a.key]),n},b=function(e,t,r){if(!t.topLevelFormName||t[t.topLevelFormName].$pristine){l(e.name,r.master,function(r){return u(e,r,t[p(e,"Options")],t[p(e,"_ids")])});var n=v(r.master,e.name);n&&g(t.record,e.name,void 0,n)}},y=function(e,t,r){for(var n=t.split("."),a=0;a<n.length;a++)void 0!==e&&(e=e[n[a]]);return e&&-1!==r.indexOf(n[a-1])&&(e=e.text||e),void 0===e&&(e=""),e},w=function(e){var t=!1;return"text"===e.type?t=!0:(e.needsX||"select"===e.type&&!e.ids&&!e.directive)&&(t=!0),t},k=function(e,t,r,n,a){a=a||t;for(var o=0;o<e.length;o++){var i=e[o],s=i.name.slice(r),l=v(t,s);if(i.schema){if(l)for(var c=0;c<l.length;c++)l[c]=k(i.schema,l[c],r+1+s.length,n,a)}else{var d=y(t,s,n.select2List);if(i.array&&w(i)&&d)for(var f=0;f<d.length;f++)d[f]={x:d[f]};var m=n[p(i,"_ids")];if(l&&m&&m.length>0){if(-1!==s.indexOf("."))throw new Error("Trying to directly assign to a nested field 332");t[s]=u(i,l,n[p(i,"Options")],m)}else if(i.select2&&!i.select2.fngAjax){if(l)if(i.array)for(var h=0;h<l.length;h++)n[i.select2.s2query].query({term:l[h].x.text||l[h].text||l[h].x||l[h],callback:function(e){if(e.results.length>0)if(l[h].x){if(-1!==s.indexOf("."))throw new Error("Trying to directly assign to a nested field 342");t[s][h].x=e.results[0]}else{if(-1!==s.indexOf("."))throw new Error("Trying to directly assign to a nested field 345");t[s][h]=e.results[0]}}});else n[i.select2.s2query].query({term:l,callback:function(e){if(e.results.length>0){if(-1!==s.indexOf("."))throw new Error("Trying to directly assign to a nested field 357");t[s]=e.results[0]}}})}else if(i.select2)void i.select2;else if(l&&n.conversions[i.name]&&n.conversions[i.name].fngajax){var b=i;n.conversions[b.name].fngajax(l,b,function(e,t){g(a,e.name,void 0,t),C(angular.element("#"+e.id),function(){g(n.record,e.name,void 0,t)})})}}}return t},x=function(e,t,r,n){var a=_.isObject(e)?e.x||e.text:e;if(a&&a.match(/^[0-9a-f]{24}$/))return a;var o=t.indexOf(a);if(-1===o)throw new Error("convertListValueToId: Invalid data - value "+a+" not found in "+t+" processing "+n);return r[o]},C=function(e,t){var r=e.inheritedData("$ngModelController"),n=r&&r.$pristine;n&&(r.$pristine=!1),t(),n&&(r.$pristine=!0)},$=function(e,t,r,n){var a=t.indexOf(e);if(-1===a)throw new Error("convertIdToListValue: Invalid data - id "+e+" not found in "+t+" processing "+n);return r[a]},S=function(e,t,r){r.master=k(t.formSchema,e,0,t),t.phase="ready",t.cancel()};return{readRecord:function(t,r,n){o.readRecord(t.modelName,t.id).success(function(n){n.success===!1&&e.path("/404"),r.allowLocationChange=!1,t.phase="reading","function"==typeof t.dataEventFunctions.onAfterRead&&t.dataEventFunctions.onAfterRead(n),S(n,t,r)}).error(n)},scrollTheList:function(t,r){var n=t.pagesLoaded;o.getPagedAndFilteredList(t.modelName,{aggregate:e.$$search.a,find:e.$$search.f,limit:t.pageSize,skip:n*t.pageSize,order:e.$$search.o}).success(function(e){angular.isArray(e)?n===t.pagesLoaded?(t.pagesLoaded++,t.recordList=t.recordList.concat(e)):console.log("DEBUG: infinite scroll component asked for a page twice"):t.showError(e,"Invalid query")}).error(r)},deleteRecord:function(t,r,n,i){o.deleteRecord(t,r).success(function(){"function"==typeof n.dataEventFunctions.onAfterDelete&&n.dataEventFunctions.onAfterDelete(i.master),a.redirectTo()("list",n,e)})},updateDocument:function(e,r,n,a,i){n.phase="updating",o.updateRecord(n.modelName,n.id,e).success(function(e){e.success!==!1?("function"==typeof n.dataEventFunctions.onAfterUpdate&&n.dataEventFunctions.onAfterUpdate(e,i.master),r.redirect?(r.allowChange&&(i.allowLocationChange=!0),t.location=r.redirect):(S(e,n,i),n.setPristine())):n.showError(e)}).error(a)},createNew:function(r,n,i,s){o.createRecord(i.modelName,r).success(function(r){r.success!==!1?("function"==typeof i.dataEventFunctions.onAfterCreate&&i.dataEventFunctions.onAfterCreate(r),n.redirect?t.location=n.redirect:a.redirectTo()("edit",i,e,r._id)):i.showError(r)}).error(s)},getListData:y,suffixCleanId:p,setData:g,setUpSelectOptions:function(e,t,r,n,a,s){var l=r[t.options]=[],c=r[t.ids]=[];i.getSchema(e).success(function(i){var u=[];a("Lookup "+e,i,null,u,"",!1,r,n,s);var d;"undefined"!=typeof t.filter&&t.filter?(console.log("filtering"),d=o.getPagedAndFilteredList(e,t.filter)):d=o.getAll(e),d.success(function(e){if(e){for(var a=0;a<e.length;a++){for(var o="",i=0;i<u.length;i++)o+=e[a][u[i].name]+" ";o=o.trim();var s=_.sortedIndex(l,o);l[s]===o&&(o=o+"    ("+e[a]._id+")",s=_.sortedIndex(l,o)),l.splice(s,0,o),c.splice(s,0,e[a]._id)}b(t,r,n)}})})},preservePristine:C,convertToMongoModel:function A(e,t,r,n){function a(e,t){var r;return t.select2&&t.select2.fngAjax||n.conversions[t.name]&&n.conversions[t.name].fngajax?e&&e.id&&(r=e.id):e&&(r=e.text||(e.x?e.x.text:e)),r}for(var o=0;o<e.length;o++){var i=e[o].name.slice(r),s=y(t,i,n.select2List);if(e[o].schema){if(s)for(var c=0;c<s.length;c++)s[c]=A(e[o].schema,s[c],r+1+i.length,n)}else{if(e[o].array&&w(e[o])&&s)for(var u=0;u<s.length;u++)s[u]=s[u].x;var f=n[p(e[o],"_ids")];if(f&&f.length>0)l(i,t,function(t){return d(e[o],t,n[p(e[o],"Options")],f)});else if(n.conversions[e[o].name]){var m,h=v(t,i,null);if(e[o].array){if(m=[],h)for(var b=0;b<h.length;b++)m[b]=a(h[b],e[o])}else m=a(h,e[o]);g(t,i,null,m)}}}return t},convertIdToListValue:$,handleError:f,decorateScope:function(r,o,i,s){r.cancel=function(){angular.copy(s.master,r.record),n(r.setPristine)};var l=f(r);r.$on("showErrorMessage",function(e,t){r.showError(t.body,t.title)}),r.showError=function(e,t){r.alertTitle=t?t:"Error!",r.errorMessage=e},r.dismissError=function(){delete r.errorMessage},r.save=function(e){e=e||{};var t=i.convertToMongoModel(r.formSchema,angular.copy(r.record),0,r);r.id?"function"==typeof r.dataEventFunctions.onBeforeUpdate?r.dataEventFunctions.onBeforeUpdate(t,s.master,function(n){n?r.showError(n):i.updateDocument(t,e,r,l,s)}):i.updateDocument(t,e,r,l,s):"function"==typeof r.dataEventFunctions.onBeforeCreate?r.dataEventFunctions.onBeforeCreate(t,function(n){n?r.showError(n):i.createNew(t,e,r,l)}):i.createNew(t,e,r,l)},r.newClick=function(){a.redirectTo()("new",r,e)},r.$on("$locationChangeStart",function(e,n){if(!s.allowLocationChange&&!r.isCancelDisabled()){e.preventDefault();var a=o.open({template:'<div class="modal-header">   <h3>Record modified</h3></div><div class="modal-body">   <p>Would you like to save your changes?</p></div><div class="modal-footer">    <button class="btn btn-primary dlg-yes" ng-click="yes()">Yes</button>    <button class="btn btn-warning dlg-no" ng-click="no()">No</button>    <button class="btn dlg-cancel" ng-click="cancel()">Cancel</button></div>',controller:"SaveChangesModalCtrl",backdrop:"static"});a.result.then(function(e){e?r.save({redirect:n,allowChange:!0}):(s.allowLocationChange=!0,t.location=n)})}}),r.deleteClick=function(){if(r.record._id){var e=o.open({template:'<div class="modal-header">   <h3>Delete Item</h3></div><div class="modal-body">   <p>Are you sure you want to delete this record?</p></div><div class="modal-footer">    <button class="btn btn-primary dlg-no" ng-click="cancel()">No</button>    <button class="btn btn-warning dlg-yes" ng-click="yes()">Yes</button></div>',controller:"SaveChangesModalCtrl",backdrop:"static"});e.result.then(function(e){e&&("function"==typeof r.dataEventFunctions.onBeforeDelete?r.dataEventFunctions.onBeforeDelete(s.master,function(e){e?r.showError(e):i.deleteRecord(r.modelName,r.id,r,s)}):i.deleteRecord(r.modelName,r.id,r,s))})}},r.isCancelDisabled=function(){return"function"==typeof r.disableFunctions.isCancelDisabled?r.disableFunctions.isCancelDisabled(r.record,s.master,r[r.topLevelFormName]):r[r.topLevelFormName]&&r[r.topLevelFormName].$pristine},r.isSaveDisabled=function(){return"function"==typeof r.disableFunctions.isSaveDisabled?r.disableFunctions.isSaveDisabled(r.record,s.master,r[r.topLevelFormName]):r[r.topLevelFormName]&&(r[r.topLevelFormName].$invalid||r[r.topLevelFormName].$pristine)},r.isDeleteDisabled=function(){return"function"==typeof r.disableFunctions.isDeleteDisabled?r.disableFunctions.isDeleteDisabled(r.record,s.master,r[r.topLevelFormName]):!r.id},r.isNewDisabled=function(){return"function"==typeof r.disableFunctions.isNewDisabled?r.disableFunctions.isNewDisabled(r.record,s.master,r[r.topLevelFormName]):!1},r.disabledText=function(e){var t="";return r.isSaveDisabled&&(t="This button is only enabled when the form is complete and valid.  Make sure all required inputs are filled in. "+e),t},r.getVal=function(e,t){return-1===e.indexOf("$index")||"undefined"!=typeof t?(e=e.replace(/\$index/g,t),r.$eval("record."+e)):void 0}},fillFormFromBackendCustomSchema:m,fillFormWithBackendSchema:function(e,t,r,n,a){i.getSchema(e.modelName,e.formName).success(function(o){m(o,e,t,r,n,a)}).error(a)}}})}(e||(e={}));var e;!function(e){e.formsAngular.factory("SchemasService",["$http",function(e){return{getSchema:function(t,r){return e.get("/api/schema/"+t+(r?"/"+r:""),{cache:!0})}}}])}(e||(e={}));var e;return function(e){e.formsAngular.factory("SubmissionsService",["$http",function(e){var t=function(e){var t="",r=function(e,r){r&&""!==r&&("object"==typeof r&&(r=JSON.stringify(r)),""===t?t="?":t+="&",t+=e+"="+r)};return r("l",e.limit),r("f",e.find),r("a",e.aggregate),r("o",e.order),r("s",e.skip),t};return{getListAttributes:function(t,r){return e.get("/api/"+t+"/"+r+"/list")},readRecord:function(t,r){return e.get("/api/"+t+"/"+r)},getAll:function(t){return e.get("/api/"+t,{cache:!0})},getPagedAndFilteredList:function(r,n){return e.get("/api/"+r+t(n))},deleteRecord:function(t,r){return e["delete"]("/api/"+t+"/"+r)},updateRecord:function(t,r,n){return e.post("/api/"+t+"/"+r,n)},createRecord:function(t,r){return e.post("/api/"+t,r)}}}])}(e||(e={})),e});
//# sourceMappingURL=forms-angular.min.js.map